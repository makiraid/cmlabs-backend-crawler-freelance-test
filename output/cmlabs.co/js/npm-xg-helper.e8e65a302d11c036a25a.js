"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[7689],{93254:(e,t,i)=>{function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}i.d(t,{Z:()=>a});const a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,i=[{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}],null&&r(t.prototype,null),i&&r(t,i),e}()},54659:(e,t,i)=>{i.d(t,{Z:()=>s});var r=i(9767),a=i(35461);function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,i=[{key:"getNalunits",value:function(t){if(t.length-t.position<4)return[];var i=t.dataview,r=t.position;return 1===i.getInt32(r)||0===i.getInt16(r)&&1===i.getInt8(r+2)?e.getAnnexbNals(t):e.getAvccNals(t)}},{key:"getAnnexbNals",value:function(t){for(var i=[],r=e.getHeaderPositionAnnexB(t),a=r.pos,n=a;a<t.length-4;){var s=t.buffer.slice(a,a+r.headerLength);r.pos===t.position&&t.skip(r.headerLength),n=(r=e.getHeaderPositionAnnexB(t)).pos;var o={header:s,body:new Uint8Array(t.buffer.slice(a+s.byteLength,n))};e.analyseNal(o),o.type<=9&&0!==o.type&&i.push(o),t.skip(n-t.position),a=n}return i}},{key:"getAvccNals",value:function(t){for(var i=[];t.position<t.length-4;){var r=t.dataview.getInt32(t.dataview.position);if(!(t.length-t.position>=r))break;var a=t.buffer.slice(t.position,t.position+4);t.skip(4);var n=new Uint8Array(t.buffer.slice(t.position,t.position+r));t.skip(r);var s={header:a,body:n};e.analyseNal(s),s.type<=9&&0!==s.type&&i.push(s)}return i}},{key:"analyseNal",value:function(e){var t=31&e.body[0];switch(e.type=t,t){case 1:e.ndr=!0;break;case 5:e.idr=!0;break;case 6:try{e.sei=a.Z.parse(e.body)}catch(e){}break;case 7:e.sps=r.Z.parseSPS(e.body);break;case 8:e.pps=!0}}},{key:"getHeaderPositionAnnexB",value:function(e){for(var t=e.position,i=0,r=e.length;3!==i&&4!==i&&t<r-4;)0===e.dataview.getInt16(t)?1===e.dataview.getInt16(t+2)?i=4:1===e.dataview.getInt8(t+2)?i=3:t++:t++;return t===r-4&&(0===e.dataview.getInt16(t)?1===e.dataview.getInt16(t+2)?i=4:t=r:(t++,0===e.dataview.getInt16(t)&&1===e.dataview.getInt8(t)?i=3:t=r)),{pos:t,headerLength:i}}},{key:"getAvcc",value:function(e,t){var i=new Uint8Array(e.byteLength+t.byteLength+11);i[0]=1,i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=255,i[5]=225;var r=6;return i.set(new Uint8Array([e.byteLength>>>8&255,255&e.byteLength]),r),r+=2,i.set(e,r),i[r+=e.byteLength]=1,r++,i.set(new Uint8Array([t.byteLength>>>8&255,255&t.byteLength]),r),r+=2,i.set(t,r),i}}],null&&n(t.prototype,null),i&&n(t,i),e}()},35461:(e,t,i)=>{function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}i.d(t,{Z:()=>o});const a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,i=[{key:"EBSP2RBSP",value:function(e){return e.filter((function(t,i){return i<2||!(0===e[i-2]&&0===e[i-1]&&3===t)}))}},{key:"EBSP2SODB",value:function(e){var t=e[e.byteLength-1];return t&&128===t?e.slice(0,e.byteLength-1):e}}],null&&r(t.prototype,null),i&&r(t,i),e}();function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(e){for(var t="",i=0;i<e.byteLength;i++)t+=String.fromCharCode(e[i]);return t};const o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,i=[{key:"_resolveNalu",value:function(e){return e.length>=1?a.EBSP2SODB(a.EBSP2RBSP(e.slice(1))):null}},{key:"parse",value:function(t){var i=e._resolveNalu(t),r=e.switchPayloadType(i),a=r.payloadType,n=r.offset,s=i.slice(n);return 5===a?e.user_data_unregistered(s):{code:a,content:s}}},{key:"switchPayloadType",value:function(e){for(var t=new DataView(e.buffer),i=0,r=0;255===t.getUint8(r);)r++,i+=255;return{payloadType:i+=t.getUint8(r++),offset:r}}},{key:"getPayloadLength",value:function(e){for(var t=new DataView(e.buffer),i=0,r=0;255===t.getUint8(r);)r++,i+=255;return{payloadLength:i+=t.getUint8(r++),offset:r}}},{key:"user_data_unregistered",value:function(t){var i=e.getPayloadLength(t),r=i.payloadLength,a=i.offset;if(r<16)return{uuid:"",content:null};var n=t.slice(a);return{code:5,uuid:s(n.slice(0,16)),content:s(n.slice(16,r))}}}],null&&n(t.prototype,null),i&&n(t,i),e}()},9767:(e,t,i)=>{function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}i.d(t,{Z:()=>s});const a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="Golomb",this._buffer=t,this._bufferIndex=0,this._totalBytes=t.byteLength,this._totalBits=8*t.byteLength,this._currentWord=0,this._currentWordBitsLeft=0}var t,i;return t=e,(i=[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._totalBytes-this._bufferIndex,t=Math.min(4,e),i=new Uint8Array(4);i.set(this._buffer.subarray(this._bufferIndex,this._bufferIndex+t)),this._currentWord=new DataView(i.buffer).getUint32(0),this._bufferIndex+=t,this._currentWordBitsLeft=8*t}},{key:"readBits",value:function(e){var t=Math.min(this._currentWordBitsLeft,e),i=this._currentWord>>>32-t;if(e>32)throw new Error("Cannot read more than 32 bits at a time");return this._currentWordBitsLeft-=t,this._currentWordBitsLeft>0?this._currentWord<<=t:this._totalBytes-this._bufferIndex>0&&this._fillCurrentWord(),(t=e-t)>0&&this._currentWordBitsLeft?i<<t|this.readBits(t):i}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e;for(e=0;e<this._currentWordBitsLeft;e++)if(0!=(this._currentWord&2147483648>>>e))return this._currentWord<<=e,this._currentWordBitsLeft-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}},{key:"readSliceType",value:function(){return this.readByte(),this.readUEG(),this.readUEG()}}])&&r(t.prototype,i),e}();function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,i=[{key:"_ebsp2rbsp",value:function(e){for(var t=e,i=t.byteLength,r=new Uint8Array(i),a=0,n=0;n<i;n++)n>=2&&3===t[n]&&0===t[n-1]&&0===t[n-2]||(r[a]=t[n],a++);return new Uint8Array(r.buffer,0,a)}},{key:"parseSPS",value:function(t){var i=e._ebsp2rbsp(t),r=new a(i);r.readByte();var n=r.readByte();r.readByte();var s=r.readByte();r.readUEG();var o=e.getProfileString(n),u=e.getLevelString(s),l=1,d=420,c=8;if((100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n||138===n||144===n)&&(3===(l=r.readUEG())&&r.readBits(1),l<=3&&(d=[0,420,422,444][l]),c=r.readUEG()+8,r.readUEG(),r.readBits(1),r.readBool()))for(var h=3!==l?8:12,f=0;f<h;f++)r.readBool()&&(f<6?e._skipScalingList(r,16):e._skipScalingList(r,64));r.readUEG();var p=r.readUEG();if(0===p)r.readUEG();else if(1===p){r.readBits(1),r.readSEG(),r.readSEG();for(var v=r.readUEG(),y=0;y<v;y++)r.readSEG()}r.readUEG(),r.readBits(1);var m=r.readUEG(),g=r.readUEG(),_=r.readBits(1);0===_&&r.readBits(1),r.readBits(1);var b=0,E=0,S=0,k=0;r.readBool()&&(b=r.readUEG(),E=r.readUEG(),S=r.readUEG(),k=r.readUEG());var A=1,T=1,D=0,w=!0,R=0,L=0;if(r.readBool()){if(r.readBool()){var B=r.readByte();B>0&&B<16?(A=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][B-1],T=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][B-1]):255===B&&(A=r.readByte()<<8|r.readByte(),T=r.readByte()<<8|r.readByte())}if(r.readBool()&&r.readBool(),r.readBool()&&(r.readBits(4),r.readBool()&&r.readBits(24)),r.readBool()&&(r.readUEG(),r.readUEG()),r.readBool()){var x=r.readBits(32),C=r.readBits(32);w=r.readBool(),D=(R=C)/(L=2*x)}}var O=1;1===A&&1===T||(O=A/T);var I=0,U=0;0===l?(I=1,U=2-_):(I=3===l?1:2,U=(1===l?2:1)*(2-_));var P=16*(m+1),M=16*(g+1)*(2-_);P-=(b+E)*I,M-=(S+k)*U;var G=Math.ceil(P*O);return r.destroy(),r=null,{profile_string:o,level_string:u,bit_depth:c,chroma_format:d,chroma_format_string:e.getChromaFormatString(d),frame_rate:{fixed:w,fps:D,fps_den:L,fps_num:R},par_ratio:{width:A,height:T},codec_size:{width:P,height:M},present_size:{width:G,height:M}}}},{key:"_skipScalingList",value:function(e,t){for(var i=8,r=8,a=0;a<t;a++)0!==r&&(r=(i+e.readSEG()+256)%256),i=0===r?i:r}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}},{key:"toVideoMeta",value:function(e){var t={};e&&e.codec_size&&(t.codecWidth=e.codec_size.width,t.codecHeight=e.codec_size.height,t.presentWidth=e.present_size.width,t.presentHeight=e.present_size.height),t.profile=e.profile_string,t.level=e.level_string,t.bitDepth=e.bit_depth,t.chromaFormat=e.chroma_format,t.parRatio={width:e.par_ratio.width,height:e.par_ratio.height},t.frameRate=e.frame_rate;var i=t.frameRate.fps_den,r=t.frameRate.fps_num;return t.refSampleDuration=Math.floor(t.timescale*(i/r)),t}}],null&&n(t.prototype,null),i&&n(t,i),e}()},23560:(e,t,i)=>{i.d(t,{Z:()=>d});var r=i(91780),a=i(33971),n=i(93254);function s(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?o(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function u(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=r.Z.REMUX_EVENTS;const d=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="Compatibility",this.nextAudioDts=0,this.nextVideoDts=0,this.lastAudioSamplesLen=0,this.lastVideoSamplesLen=0,this.lastVideoDts=void 0,this.lastAudioDts=void 0,this.allAudioSamplesCount=0,this.allVideoSamplesCount=0,this._firstAudioSample=null,this._firstVideoSample=null,this.filledAudioSamples=[],this.filledVideoSamples=[],this._lastSegmentId=0,this._currentSegmentId=0,this.videoLastSample=null,this.audioLastSample=null,Object.defineProperties(this,{_videoLargeGap:{set:function(e){t.___videoLargeGap=e,a.Z.warn(t.TAG,"videoLargGap:",e),0!==e&&t.emit(l.DETECT_LARGE_GAP,"video",e)},get:function(){return t.___videoLargeGap||0}},_audioLargeGap:{set:function(e){t.___audioLargeGap=e,a.Z.warn(t.TAG,"audioLargeGap:",e),0!==e&&t.emit(l.DETECT_LARGE_GAP,"audio",e)},get:function(){return t.___audioLargeGap||0}}}),this.audioUnsyncTime=0}var t,i,r;return t=e,r=[{key:"sortAudioSamples",value:function(e){return 1===e.length?e:s(e).sort((function(e,t){return e.dts-t.dts}))}},{key:"isRefSampleDurationValid",value:function(e){return e&&e>0&&!Number.isNaN(e)}},{key:"findFirstAudioSample",value:function(t){return t&&0!==t.length?e.sortAudioSamples(t)[0]:null}},{key:"findFirstVideoSample",value:function(e){if(!e.length)return null;for(var t=s(e).sort((function(e,t){return e.dts-t.dts})),i=0,r=t.length;i<r;i++)if(t[i].isKeyframe)return t[i]}},{key:"detectVideoLargeGap",value:function(e,t){if(null!==e)return e-t>=1e3||t-e>=1e3}},{key:"detectAudioLargeGap",value:function(e,t){if(null!==e)return e-t>=1e3||t-e>=1e3}},{key:"doFixLargeGap",value:function(e,t){for(var i=0,r=e.length;i<r;i++){var a=e[i];a.dts+=t,a.pts&&(a.pts+=t)}var n=e[0];n&&0===n.dts&&(n.dts=n.pts=1)}},{key:"detectChangeStream",value:function(e,t){for(var i=!1,r=[],a=0,n=e.length;a<n;a++){var s=e[a];!s.options||!s.options.meta||t&&0===a||(i=!0,r.push(a))}return{changed:i,changedIdxes:r}}}],(i=[{key:"init",value:function(){this.before(l.REMUX_MEDIA,this.doFix.bind(this))}},{key:"reset",value:function(){this.nextAudioDts=null,this.nextVideoDts=null,this.lastAudioSamplesLen=0,this.lastVideoSamplesLen=0,this.lastVideoDts=void 0,this.lastAudioDts=void 0,this._audioLargeGap=0,this._videoLargeGap=0,this.videoLastSample=null,this.audioLastSample=null,this.filledAudioSamples=[],this.filledVideoSamples=[],this.audioUnsyncTime=0}},{key:"_isSegmentsContinuous",value:function(){return 0===this._lastSegmentId||this._currentSegmentId-this._lastSegmentId==1}},{key:"doFix",value:function(){var t,i,r,n=0;this.videoTrack.samples.length&&(t=(i=this.videoTrack.samples[0]).options,a.Z.long&&a.Z.log(this.TAG,this.videoTrack.samples.slice())),this.audioTrack.samples.length&&(r=this.audioTrack.samples[0],a.Z.long&&a.Z.log(this.TAG,this.audioTrack.samples.slice())),i&&r&&(n=r.dts-i.dts),this._currentSegmentId=t&&t.id||this._currentSegmentId+1,a.Z.log(this.TAG,"lastSeg:".concat(this._lastSegmentId," , currentSeg:").concat(this._currentSegmentId,", discontinue:").concat(t&&t.discontinue," vSamp0:").concat(i&&i.dts," aSamp0:").concat(r&&r.dts));var s=this.getFirstSample(),o=s.isFirstAudioSamples,u=s.isFirstVideoSamples;this.recordSamplesCount(),this._firstVideoSample&&this.fixVideoRefSampleDuration(this.videoTrack.meta,this.videoTrack.samples);var d=e.detectChangeStream(this.videoTrack.samples,u),c=d.changed,h=d.changedIdxes;if(c){for(var f=!1,p=0;p<h.length;p++)this.fixChangeStreamVideo(h[p],u)&&(f=!0);f||this.doFixVideo(u)}else if(!this._isSegmentsContinuous()&&t&&void 0!==t.start){this.videoLastSample=null;var v=t.start;n<0&&(v-=n),a.Z.log(this.TAG,"fix video for _isSegmentsContinuous()， delta:",n),this.doFixVideo(u,v),this.emit(l.DETECT_FRAG_ID_DISCONTINUE,t.start/1e3)}else this.doFixVideo(u);this._appendSampleForLastSegment(t&&t.isLast);var y=e.detectChangeStream(this.audioTrack.samples,o),m=y.changed,g=y.changedIdxes;if(m){for(var _=!1,b=0;b<g.length;b++)this.fixChangeStreamAudio(g[b],o)&&(_=!0);if(_)return;this.doFixAudio(o)}else{var E;!this._isSegmentsContinuous()&&t&&void 0!==t.start?(a.Z.log(this.TAG,"fix audio for _isSegmentsContinuous()"),this.nextAudioDts=t.start||(null===(E=this.audioTrack.samples[0])||void 0===E?void 0:E.dts),this.doFixAudio(o,t.start),this.emit(l.DETECT_FRAG_ID_DISCONTINUE,t.start/1e3)):this.doFixAudio(o)}this.removeInvalidSamples(),this._lastSegmentId=this._currentSegmentId}},{key:"doFixVideo",value:function(t,i){for(var r=this.videoTrack,n=r.samples,s=r.meta,o=n.length,u=0;u<o;u++){var d=n[u];d.originDts=d.dts,d.originPts=d.pts}if(n&&o&&this._firstVideoSample){var c=n[0];if(a.Z.log(this.TAG,"doFixVideo:: lastVideoDts: ".concat(this.lastVideoDts," ,  _videoLargeGap: ").concat(this._videoLargeGap," ,streamChangeStart:").concat(i,", lastVideoSample:[dts=").concat(this.videoLastSample&&this.videoLastSample.dts," , pts=").concat(this.videoLastSample&&this.videoLastSample.pts,"] ,  firstDTS:").concat(c.dts," ,firstPTS:").concat(c.pts," ,lastDTS:").concat(n[o-1].dts," , lastPTS: ").concat(n[o-1].pts)),!t&&void 0===i&&this.videoLastSample&&e.detectVideoLargeGap(this.videoLastSample?this.videoLastSample.dts:0,c.dts+this._videoLargeGap)&&(this._videoLargeGap=this.videoLastSample.dts+s.refSampleDuration-c.dts),0!==this._videoLargeGap&&(e.doFixLargeGap(n,this._videoLargeGap),this._videoLargeGap!==this.preVideoGap&&(this.preVideoGap=this._videoLargeGap,this.emit(l.DETECT_CHANGE_STREAM_DISCONTINUE,"video",{prevDts:this.videoLastSample&&this.videoLastSample.originDts,curDts:c.originDts}))),t||void 0===i||0===i||(this._videoLargeGap=i-c.dts,e.doFixLargeGap(n,this._videoLargeGap)),t&&this._firstAudioSample){var h=this._firstVideoSample.originDts,f=h-this._firstAudioSample.dts;if(f>2*s.refSampleDuration&&f<10*s.refSampleDuration){for(var p=Math.floor(f/s.refSampleDuration),v=0;v<p;v++){var y=Object.assign({},c);y.dts=h-(v+1)*s.refSampleDuration,y.pts=y.dts+y.cts,n.unshift(y),this.filledVideoSamples.push({dts:y.dts,size:y.data.byteLength})}this._firstVideoSample=this.filledVideoSamples[0]||this._firstVideoSample}else Math.abs(f)>2*s.refSampleDuration&&!this._videoLargeGap&&(this._videoLargeGap=-1*f,e.doFixLargeGap(n,-1*f))}for(var m=n.length,g=1;g<m;g++){var _=n[g],b=n[g-1],E=_.dts-_.pts;Math.abs(E)<2e3&&Math.abs(_.dts-b.dts)>1e4&&(_.dts=b.dts+s.refSampleDuration,_.pts=b.pts+s.refSampleDuration)}var S=n.pop();if(n.length&&(n[n.length-1].duration=S.dts-n[n.length-1].dts),m<4){var k=n[n.length-1],A=(k=k||S).options&&k.options.duration,T=s.refSampleDuration;if(A&&T&&A/T>5)for(var D=k.pts,w=k.dts,R=0;R<3;R++){w+=T,D+=T;var L=Object.assign({},k,{dts:w,pts:D});2===R&&(L.duration=A),n.push(L)}S=null}if(this.videoLastSample){var B=this.videoLastSample;B.duration=c.dts-B.dts,n.unshift(this.videoLastSample)}this.videoLastSample=S,n[n.length-1]&&(this.lastVideoDts=n[n.length-1].dts),this.videoTrack.samples=n}}},{key:"_appendSampleForLastSegment",value:function(e){e&&this.videoLastSample&&this.videoTrack.samples.push(this.videoLastSample)}},{key:"doFixAudio",value:function(t,i){var r=this,s=this.audioTrack,o=s.samples,u=s.meta;if(o&&o.length){this.fixAudioRefSampleDuration(u);for(var d=0,c=o.length;d<c;d++){var h=o[d];h.originDts=h.dts}var f,p=o.length,v=n.Z.getSilentFrame(u.codec,u.channelCount),y=Math.floor(u.refSampleDuration),m=this._firstAudioSample,g=o[0];if(a.Z.log(this.TAG,"doFixAudio:: audioDtsBase:".concat(this.audioDtsBase," ,  _audioLargeGap: ").concat(this._audioLargeGap,", streamChangeStart:").concat(i," ,  nextAudioDts:").concat(this.nextAudioDts,",  audio: firstDTS:").concat(g.dts," ,firstPTS:").concat(g.pts," ,lastDTS:").concat(o[p-1].dts," , lastPTS: ").concat(o[p-1].pts)),!t&&null===this.nextAudioDts&&g.options&&g.options.start&&void 0!==i&&(i=g.options.start),!t&&void 0===i&&this.nextAudioDts&&e.detectAudioLargeGap(this.nextAudioDts||0,g.dts+this._audioLargeGap)){var _=this.nextAudioDts-g.dts;this._audioLargeGap=Math.abs(_-this._videoLargeGap)<200?this._videoLargeGap:_}if(0!==this._audioLargeGap?(e.doFixLargeGap(o,this._audioLargeGap),this._audioLargeGap!==this.preAudioGap&&(this.preAudioGap=this._audioLargeGap,this.emit(l.DETECT_CHANGE_STREAM_DISCONTINUE,"audio",{prevDts:this.lastAudioOriginDts,curDts:g.originDts}))):t||void 0===i&&!e.detectAudioLargeGap(this.nextAudioDts,g.dts)||(void 0!==i&&0!==i&&(this.nextAudioDts=i),this._audioLargeGap=this.nextAudioDts-g.dts,g.options.start&&!g.options.start.isContinue&&e.doFixLargeGap(o,this._audioLargeGap)),this._firstVideoSample&&t){var b=this._firstVideoSample.originDts||this._firstVideoSample.dts,E=m.dts-b;if(E===this._videoLargeGap);else if(E>u.refSampleDuration&&E<10*u.refSampleDuration){for(var S=Math.floor((m.dts-b)/u.refSampleDuration),k=0;k<S;k++){var A={data:v,datasize:v.byteLength,dts:m.dts-(k+1)*u.refSampleDuration,filtered:0};o.unshift(A),this.filledAudioSamples.push({dts:A.dts,size:A.data.byteLength})}this._firstAudioSample=this.filledAudioSamples[0]||this._firstAudioSample}else E<-1*u.refSampleDuration&&(this._audioLargeGap=-1*E,e.doFixLargeGap(o,-1*E))}var T=o[0].dts;if(this.nextAudioDts){f=T-this.nextAudioDts;var D=Math.abs(f);if(f>=y&&f<1e4&&v){for(var w=Math.ceil(f/y),R=0;R<w;R++){var L=T-(R+1)*y,B={dts:L>this.nextAudioDts?L:this.nextAudioDts,pts:L>this.nextAudioDts?L:this.nextAudioDts,datasize:v.byteLength,filtered:0,data:v};this.filledAudioSamples.push({dts:B.dts,size:B.data.byteLength}),this.audioTrack.samples.unshift(B),g=B}this.emit(l.DETECT_AUDIO_GAP,f,w)}else D<u.refSampleDuration&&D>0?(g.dts=this.nextAudioDts,g.pts=this.nextAudioDts):f<0&&D<y&&(e.doFixLargeGap(o,-1*f),this.emit(l.DETECT_AUDIO_OVERLAP,f))}for(var x=o[0].dts+y,C=1;C<o.length;){var O=o[C],I=O.dts-x;if(I<=-1*y)a.Z.warn("drop 1 audio sample for ".concat(I," ms overlap")),o.splice(C,1);else if(I>=10*y){var U=Math.round(I/y);if(U>1e3)break;a.Z.warn(this.TAG,"inject ".concat(U," audio frame for ").concat(I," ms gap"));for(var P=0;P<U;P++){var M={data:v,datasize:v.byteLength,dts:x,originDts:x,filtered:0};o.splice(C,0,M),x+=y,C++}O.dts=O.pts=O.originDts=x,x+=y,C++}else O.dts=O.pts=O.originDts=x,x+=y,C++}var G=u.refSampleDuration-y;o.forEach((function(e,t){if(0!==t){var i=o[t-1];e.dts=e.pts=i.dts+i.duration}e.duration=y,r.audioUnsyncTime=r.audioUnsyncTime+G,r.audioUnsyncTime>=1&&(e.duration+=1,r.audioUnsyncTime-=1)}));var V=o[o.length-1];this.lastAudioDts=V.dts;var F=V.duration;this.lastAudioSamplesLen=p,this.nextAudioDts=this.lastAudioDts+(F||y),this.lastAudioOriginDts=V.originDts,this.audioTrack.samples=e.sortAudioSamples(o)}}},{key:"fixChangeStreamVideo",value:function(e){a.Z.log(this.TAG,"fixChangeStreamVideo(), changeIdx=",e);var t=this.videoTrack.samples,i=0===e?this.lastVideoDts?this.lastVideoDts:this.getStreamChangeStart(t[0]):t[e-1].dts,r=t[e].dts,n=Math.abs(i-r)<=1e4;if(this.emit(l.DETECT_CHANGE_STREAM,"video",r),n)return t[e].options?t[e].options.isContinue=!0:t[e].options={isContinue:!0},!1;this.emit(l.DETECT_CHANGE_STREAM_DISCONTINUE,"video",{prevDts:i,curDts:r});var s,o=t.slice(0,e),u=t.slice(e),d=t[e];return this._videoLargeGap=0,this.videoLastSample=null,this.lastVideoDts=null,s=d.options&&void 0!==d.options.start?d.options.start:i-this.videoDtsBase,this.videoTrack.samples=t.slice(0,e),this.doFixVideo(!1),this.videoTrack.samples=t.slice(e),this.doFixVideo(!1,s),this.videoTrack.samples=o.concat(u),!0}},{key:"fixChangeStreamAudio",value:function(e){a.Z.log(this.TAG,"fixChangeStreamAudio(), changeIdx=",e);var t=this.audioTrack.samples,i=0===e?this.lastAudioDts:t[e-1].dts,r=t[e].dts,n=Math.abs(i-r)<=1e4;if(this.emit(l.DETECT_CHANGE_STREAM,"audio",r),n)return t[e].options?t[e].options.isContinue=!0:t[e].options={isContinue:!0},!1;this.emit(l.DETECT_CHANGE_STREAM_DISCONTINUE,"audio",{prevDts:i,curDts:r}),this._audioLargeGap=0;var s=this.nextAudioDts;this.nextAudioDts=null;var o,u=t.slice(0,e),d=t.slice(e),c=t[e];return c.options&&void 0!==c.options.start?o=c.options.start:(o=s,c.options.isContinue=!0),this.audioTrack.samples=u,this.doFixAudio(!1),this.audioTrack.samples=d,this.doFixAudio(!1,o),this.audioTrack.samples=u.concat(d),!0}},{key:"getFirstSample",value:function(){var t=this.videoTrack.samples,i=this.audioTrack.samples,r=!1,a=!1;return!this._firstVideoSample&&t.length&&(this._firstVideoSample=e.findFirstVideoSample(t),this.removeInvalidSamples(),r=!0),!this._firstAudioSample&&i.length&&(this._firstAudioSample=e.findFirstAudioSample(i),this.removeInvalidSamples(),a=!0),{isFirstVideoSamples:r,isFirstAudioSamples:a}}},{key:"fixVideoRefSampleDuration",value:function(t,i){if(t){var r=this.allVideoSamplesCount,a=this._firstVideoSample.dts,n=this.filledVideoSamples.length;if(e.isRefSampleDurationValid(t.refSampleDuration)){if(t.refSampleDuration&&i.length>=5){var s=(i[i.length-1].dts-i[0].dts)/(i.length-1);if(s>0&&s<1e3){var o=Math.floor(Math.abs(t.refSampleDuration-s)<=5?t.refSampleDuration:s);e.isRefSampleDurationValid(o)&&(t.refSampleDuration=o)}}}else if(i.length>=1){var u=i[i.length-1].dts,l=Math.floor((u-a)/(r+n-1));e.isRefSampleDurationValid(l)&&(t.refSampleDuration=l)}e.isRefSampleDurationValid(t.refSampleDuration)||(t.refSampleDuration=66)}}},{key:"fixAudioRefSampleDuration",value:function(e){e&&(e.refSampleDuration=1024*e.timescale/e.sampleRate)}},{key:"recordSamplesCount",value:function(){var e=this.audioTrack,t=this.videoTrack;this.allAudioSamplesCount+=e.samples.length,this.allVideoSamplesCount+=t.samples.length}},{key:"removeInvalidSamples",value:function(){var e=this.audioTrack.samples[0],t=this.videoTrack.samples[0];e&&(this.audioTrack.samples=this.audioTrack.samples.filter((function(t,i){return t===e||t.dts>=e.dts}))),t&&(this.videoTrack.samples=this.videoTrack.samples.filter((function(e,i){return e===t||e.dts>=t.dts})))}},{key:"getStreamChangeStart",value:function(e){return e.options&&e.options.start?e.options.start-this.dtsBase:1/0}},{key:"tracks",get:function(){return this._context.getInstance("TRACKS")}},{key:"audioTrack",get:function(){return this.tracks&&this.tracks.audioTrack?this.tracks.audioTrack:{samples:[],meta:{}}}},{key:"videoTrack",get:function(){return this.tracks&&this.tracks.videoTrack?this.tracks.videoTrack:{samples:[],meta:{}}}},{key:"dtsBase",get:function(){var e=this._context.getInstance("MP4_REMUXER");return e?e._dtsBase:0}},{key:"audioDtsBase",get:function(){var e=this._context.getInstance("MP4_REMUXER");return e&&null!==e._audioDtsBase?e._audioDtsBase:this.dtsBase}},{key:"videoDtsBase",get:function(){var e=this._context.getInstance("MP4_REMUXER");return e&&null!==e._videoDtsBase?e._videoDtsBase:this.dtsBase}}])&&u(t.prototype,i),r&&u(t,r),e}()},41419:(e,t,i)=>{i.d(t,{Z:()=>d});var r=i(91780),a=i(33971),n=i(93254);function s(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?o(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function u(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=r.Z.REMUX_EVENTS;const d=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="Compatibility",this.nextAudioDts=0,this.nextVideoDts=0,this.lastAudioSamplesLen=0,this.lastVideoSamplesLen=0,this.lastVideoDts=void 0,this.lastAudioDts=void 0,this.allAudioSamplesCount=0,this.allVideoSamplesCount=0,this._firstAudioSample=null,this._firstVideoSample=null,this.filledAudioSamples=[],this.filledVideoSamples=[],this.videoLastSample=null,this.audioLastSample=null,Object.defineProperties(this,{_videoLargeGap:{set:function(e){t.___videoLargeGap=e,Math.abs(e)>100&&t.emit(l.DETECT_LARGE_GAP,"video",e)},get:function(){return t.___videoLargeGap||0}},_audioLargeGap:{set:function(e){t.___audioLargeGap=e,Math.abs(e)>100&&t.emit(l.DETECT_LARGE_GAP,"audio",e)},get:function(){return t.___audioLargeGap||0}}}),this.audioUnsyncTime=0}var t,i,r;return t=e,r=[{key:"sortAudioSamples",value:function(e){return 1===e.length?e:s(e).sort((function(e,t){return e.dts-t.dts}))}},{key:"isRefSampleDurationValid",value:function(e){return e&&e>0&&!Number.isNaN(e)}},{key:"findFirstAudioSample",value:function(t){return t&&0!==t.length?e.sortAudioSamples(t)[0]:null}},{key:"findFirstVideoSample",value:function(e){if(!e.length)return null;for(var t=s(e).sort((function(e,t){return e.dts-t.dts})),i=0,r=t.length;i<r;i++)if(t[i].isKeyframe)return t[i]}},{key:"detectVideoLargeGap",value:function(e,t){if(null!==e)return e-t>=1e4||t-e>=1e4}},{key:"detectAudioLargeGap",value:function(e,t){if(null!==e)return e-t>=1e3||t-e>=1e3}},{key:"doFixLargeGap",value:function(e,t){for(var i=0,r=e.length;i<r;i++){var a=e[i];a.dts+=t,a.pts&&(a.pts+=t)}}},{key:"detectChangeStream",value:function(e,t){for(var i=!1,r=[],a=0,n=e.length;a<n;a++){var s=e[a];!s.options||!s.options.meta||t&&0===a||(i=!0,r.push(a))}return{changed:i,changedIdxes:r}}}],(i=[{key:"init",value:function(){this.before(l.REMUX_MEDIA,this.doFix.bind(this))}},{key:"reset",value:function(){this.nextAudioDts=null,this.nextVideoDts=null,this.lastAudioSamplesLen=0,this.lastVideoSamplesLen=0,this.lastVideoDts=void 0,this.lastAudioDts=void 0,this.lastVideoDuration=void 0,this._audioLargeGap=0,this._videoLargeGap=0,this.videoLastSample=null,this.audioLastSample=null,this.filledAudioSamples=[],this.filledVideoSamples=[],this.audioUnsyncTime=0}},{key:"doFix",value:function(){var t=this.getFirstSample(),i=t.isFirstAudioSamples,r=t.isFirstVideoSamples;this.recordSamplesCount(),this._firstVideoSample&&this.fixVideoRefSampleDuration(this.videoTrack.meta,this.videoTrack.samples);var a=e.detectChangeStream(this.videoTrack.samples,r),n=a.changed,s=a.changedIdxes;if(n){for(var o=!1,u=0;u<s.length;u++)this.fixChangeStreamVideo(s[u],r)&&(o=!0);o||this.doFixVideo(r)}else this.doFixVideo(r);var l=e.detectChangeStream(this.audioTrack.samples,i),d=l.changed,c=l.changedIdxes;if(d){for(var h=!1,f=0;f<c.length;f++)this.fixChangeStreamAudio(c[f],i)&&(h=!0);if(h)return;this.doFixAudio(i)}else this.doFixAudio(i);this.removeInvalidSamples()}},{key:"doFixVideo",value:function(t,i){for(var r=this.videoTrack,n=r.samples,s=r.meta,o=n.length,u=0;u<o;u++){var d=n[u];d.originDts=d.dts,d.originPts=d.pts}if(n&&o&&this._firstVideoSample){var c=n[0];if(a.Z.log(this.TAG,"doFixVideo:: lastVideoDts: ".concat(this.lastVideoDts," ,  _videoLargeGap: ").concat(this._videoLargeGap," ,streamChangeStart:").concat(i,", lastVideoSample:[dts=").concat(this.videoLastSample&&this.videoLastSample.dts," , pts=").concat(this.videoLastSample&&this.videoLastSample.pts,"] ,  firstDTS:").concat(c.dts," ,cts:").concat(c.cts," firstPTS:").concat(c.pts," ,lastDTS:").concat(n[o-1].dts," , lastPTS: ").concat(n[o-1].pts)),!t&&null===this.videoLastSample&&c.options&&c.options.start&&void 0!==i&&(i=c.options.start),!t&&void 0===i&&this.videoLastSample&&e.detectVideoLargeGap(this.videoLastSample?this.videoLastSample.dts:0,c.dts+this._videoLargeGap)){var h=this.audioLastSample;h&&Math.abs(h.originDts-c.originDts)<100||(this._videoLargeGap=this.videoLastSample.dts+s.refSampleDuration-c.dts)}if(0!==this._videoLargeGap&&(e.doFixLargeGap(n,this._videoLargeGap),this._videoLargeGap!==this.preVideoGap&&(this.preVideoGap=this._videoLargeGap,this.emit(l.DETECT_CHANGE_STREAM_DISCONTINUE,"video",{prevDts:this.videoLastSample&&this.videoLastSample.originDts,curDts:c.originDts,duration:s.refSampleDuration}))),t||void 0===i||(this._videoLargeGap=i-c.dts,e.doFixLargeGap(n,this._videoLargeGap)),t&&this._firstAudioSample){var f=this._firstVideoSample.originDts,p=f-(this._firstAudioSample.originDts||this._firstAudioSample.dts);if(p>2*s.refSampleDuration&&p<10*s.refSampleDuration){for(var v=Math.floor(p/s.refSampleDuration),y=0;y<v;y++){var m=Object.assign({},c);m.dts=f-(y+1)*s.refSampleDuration,m.pts=m.dts+m.cts,n.unshift(m),this.filledVideoSamples.push({dts:m.dts,size:m.data.byteLength})}this._firstVideoSample=this.filledVideoSamples[0]||this._firstVideoSample}else Math.abs(p)>2*s.refSampleDuration&&!this._videoLargeGap&&(this._videoLargeGap=-1*p,e.doFixLargeGap(n,-1*p))}var g=n.pop();if(n.length&&(n[n.length-1].duration=g.dts-n[n.length-1].dts),this.videoLastSample){var _=this.videoLastSample;_.duration=c.dts-_.dts,n.unshift(this.videoLastSample)}this.videoLastSample=g,n[n.length-1]&&(this.lastVideoDuration=n[n.length-1].duration,this.lastVideoDts=n[n.length-1].dts),this.videoTrack.samples=n}}},{key:"doFixAudio",value:function(t,i){var r=this,s=this.audioTrack,o=s.samples,u=s.meta;if(o&&o.length){this.fixAudioRefSampleDuration(u);for(var d=0,c=o.length;d<c;d++){var h=o[d];h.originDts=h.dts}var f,p=o.length,v=n.Z.getSilentFrame(u.codec,u.channelCount),y=Math.floor(u.refSampleDuration),m=this._firstAudioSample,g=o[0];if(a.Z.log(this.TAG,"doFixAudio:: audioDtsBase:".concat(this.audioDtsBase," ,  _audioLargeGap: ").concat(this._audioLargeGap,", streamChangeStart:").concat(i," ,  nextAudioDts:").concat(this.nextAudioDts,",  audio: firstDTS:").concat(g.dts," ,firstPTS:").concat(g.pts," ,lastDTS:").concat(o[p-1].dts," , lastPTS: ").concat(o[p-1].pts)),!t&&null===this.nextAudioDts&&g.options&&g.options.start&&void 0!==i&&(i=g.options.start),!t&&void 0===i&&this.nextAudioDts&&e.detectAudioLargeGap(this.nextAudioDts||0,g.dts+this._audioLargeGap)){var _=this.videoLastSample;if(_&&Math.abs(_.originDts-this.nextAudioDts)<150)this.nextAudioDts=g.dts;else{var b=this.nextAudioDts-g.dts;this._audioLargeGap=Math.abs(b-this._videoLargeGap)<200?this._videoLargeGap:b}}if(0!==this._audioLargeGap?(e.doFixLargeGap(o,this._audioLargeGap),this._audioLargeGap!==this.preAudioGap&&(this.preAudioGap=this._audioLargeGap,this.emit(l.DETECT_CHANGE_STREAM_DISCONTINUE,"audio",{prevDts:this.lastAudioOriginDts,curDts:g.originDts,duration:y}))):t||void 0===i&&!e.detectAudioLargeGap(this.nextAudioDts,g.dts)||(void 0!==i&&(this.nextAudioDts=i),this._audioLargeGap=this.nextAudioDts-g.dts,g.options.start&&!g.options.start.isContinue&&e.doFixLargeGap(o,this._audioLargeGap)),this._firstVideoSample&&t){var E=this._firstVideoSample.originDts||this._firstVideoSample.dts,S=m.dts-E;if(S===this._videoLargeGap);else if(v&&S>u.refSampleDuration&&S<10*u.refSampleDuration){for(var k=Math.floor((m.dts-E)/u.refSampleDuration),A=0;A<k;A++){var T={data:v,datasize:v.byteLength,dts:m.dts-(A+1)*u.refSampleDuration,filtered:0};o.unshift(T),this.filledAudioSamples.push({dts:T.dts,size:T.data.byteLength})}this._firstAudioSample=this.filledAudioSamples[0]||this._firstAudioSample}else S<-1*u.refSampleDuration&&(this._audioLargeGap=-1*S,e.doFixLargeGap(o,-1*S))}var D=o[0].dts;if(this.nextAudioDts){f=D-this.nextAudioDts;var w=Math.abs(f);if(f>=y&&f<1e4&&v){for(var R=Math.ceil(f/y),L=0;L<R;L++){var B=D-(L+1)*y,x={dts:B>this.nextAudioDts?B:this.nextAudioDts,pts:B>this.nextAudioDts?B:this.nextAudioDts,datasize:v.byteLength,filtered:0,data:v};this.filledAudioSamples.push({dts:x.dts,size:x.data.byteLength}),this.audioTrack.samples.unshift(x),g=x}this.emit(l.DETECT_AUDIO_GAP,f,R)}else w<u.refSampleDuration&&w>0?(g.dts=this.nextAudioDts,g.pts=this.nextAudioDts):f<0&&w<y&&(e.doFixLargeGap(o,-1*f),this.emit(l.DETECT_AUDIO_OVERLAP,f))}for(var C=o[0].dts+y,O=1;O<o.length;){var I=o[O],U=I.dts-C;if(U<=-1*y)a.Z.warn("drop 1 audio sample for ".concat(U," ms overlap")),o.splice(O,1);else if(v&&U>=10*y){var P=Math.round(U/y);if(P>1e3)break;a.Z.warn(this.TAG,"inject ".concat(P," audio frame for ").concat(U," ms gap"));for(var M=0;M<P;M++){var G={data:v,datasize:v.byteLength,dts:C,originDts:C,filtered:0};o.splice(O,0,G),C+=y,O++}I.dts=I.pts=I.originDts=C,C+=y,O++}else I.dts=I.pts=I.originDts=C,C+=y,O++}var V=u.refSampleDuration-y;o.forEach((function(e,t){if(0!==t){var i=o[t-1];e.dts=e.pts=i.dts+i.duration}e.duration=y,r.audioUnsyncTime=r.audioUnsyncTime+V,r.audioUnsyncTime>=1&&(e.duration+=1,r.audioUnsyncTime-=1)}));var F=o[o.length-1];this.lastAudioDts=F.dts;var N=F.duration;this.lastAudioSamplesLen=p,this.nextAudioDts=this.lastAudioDts+(N||y),this.lastAudioOriginDts=F.originDts,this.audioTrack.samples=e.sortAudioSamples(o),this.audioLastSample=F}}},{key:"fixChangeStreamVideo",value:function(e){a.Z.log(this.TAG,"fixChangeStreamVideo(), changeIdx=",e);var t=this.videoTrack,i=t.samples,r=t.meta,n=0===e&&this.lastVideoDuration?this.lastVideoDuration:r.refSampleDuration,s=0===e?this.lastVideoDts?this.lastVideoDts:this.getStreamChangeStart(i[0]):i[e-1].dts,o=i[e].dts,u=Math.abs(s-o)<=1e4;if(this.emit(l.DETECT_CHANGE_STREAM,"video",o),u)return i[e].options?i[e].options.isContinue=!0:i[e].options={isContinue:!0},!1;this.emit(l.DETECT_CHANGE_STREAM_DISCONTINUE,"video",{prevDts:s,curDts:o,duration:n});var d,c=i.slice(0,e),h=i.slice(e),f=i[e];return this._videoLargeGap=0,this.videoLastSample=null,this.lastVideoDts=null,this.lastVideoDuration=null,d=f.options&&void 0!==f.options.start?f.options.start:s-this.videoDtsBase,this.videoTrack.samples=i.slice(0,e),this.doFixVideo(!1),this.videoTrack.samples=i.slice(e),this.doFixVideo(!1,d),this.videoTrack.samples=c.concat(h),!0}},{key:"fixChangeStreamAudio",value:function(e){a.Z.log(this.TAG,"fixChangeStreamAudio(), changeIdx=",e);var t=this.audioTrack,i=t.samples,r=t.meta,n=0===e?this.lastAudioDts:i[e-1].dts,s=i[e].dts,o=Math.abs(n-s)<=1e4;if(this.emit(l.DETECT_CHANGE_STREAM,"audio",s),o)return i[e].options?i[e].options.isContinue=!0:i[e].options={isContinue:!0},!1;this.emit(l.DETECT_CHANGE_STREAM_DISCONTINUE,"audio",{prevDts:n,curDts:s,duration:r.refSampleDuration}),this._audioLargeGap=0;var u=this.nextAudioDts;this.nextAudioDts=null;var d,c=i.slice(0,e),h=i.slice(e),f=i[e];return f.options&&void 0!==f.options.start?d=f.options.start:(d=u,f.options.isContinue=!0),this.audioTrack.samples=c,this.doFixAudio(!1),this.audioTrack.samples=h,this.doFixAudio(!1,d),this.audioTrack.samples=c.concat(h),!0}},{key:"getFirstSample",value:function(){var t=this.videoTrack.samples,i=this.audioTrack.samples,r=!1,a=!1;return!this._firstVideoSample&&t.length&&(this._firstVideoSample=e.findFirstVideoSample(t),this.removeInvalidSamples(),r=!0),!this._firstAudioSample&&i.length&&(this._firstAudioSample=e.findFirstAudioSample(i),this.removeInvalidSamples(),a=!0),{isFirstVideoSamples:r,isFirstAudioSamples:a}}},{key:"fixVideoRefSampleDuration",value:function(t,i){if(t){var r=this.allVideoSamplesCount,a=this._firstVideoSample.dts,n=this.filledVideoSamples.length;if(e.isRefSampleDurationValid(t.refSampleDuration)){if(t.refSampleDuration&&i.length>=5){var s=(i[i.length-1].dts-i[0].dts)/(i.length-1);if(s>0&&s<1e3){var o=Math.floor(Math.abs(t.refSampleDuration-s)<=5?t.refSampleDuration:s);e.isRefSampleDurationValid(o)&&(t.refSampleDuration=o)}}}else if(i.length>=1){var u=i[i.length-1].dts;if(Math.abs(u-a)<100*i.length){var l=Math.floor((u-a)/(r+n-1));e.isRefSampleDurationValid(l)&&(t.refSampleDuration=l)}}e.isRefSampleDurationValid(t.refSampleDuration)||(t.refSampleDuration=66)}}},{key:"fixAudioRefSampleDuration",value:function(e){e&&(e.refSampleDuration=1024*e.timescale/e.sampleRate)}},{key:"recordSamplesCount",value:function(){var e=this.audioTrack,t=this.videoTrack;this.allAudioSamplesCount+=e.samples.length,this.allVideoSamplesCount+=t.samples.length}},{key:"removeInvalidSamples",value:function(){var e=this.audioTrack.samples[0],t=this.videoTrack.samples[0];e&&(this.audioTrack.samples=this.audioTrack.samples.filter((function(t,i){return t===e||t.dts>=e.dts}))),t&&(this.videoTrack.samples=this.videoTrack.samples.filter((function(e,i){return e===t||e.dts>=t.dts})))}},{key:"getStreamChangeStart",value:function(e){return e.options&&e.options.start?e.options.start-this.dtsBase:1/0}},{key:"tracks",get:function(){return this._context.getInstance("TRACKS")}},{key:"audioTrack",get:function(){return this.tracks&&this.tracks.audioTrack?this.tracks.audioTrack:{samples:[],meta:{}}}},{key:"videoTrack",get:function(){return this.tracks&&this.tracks.videoTrack?this.tracks.videoTrack:{samples:[],meta:{}}}},{key:"dtsBase",get:function(){var e=this._context.getInstance("MP4_REMUXER");return e?e._dtsBase:0}},{key:"audioDtsBase",get:function(){var e=this._context.getInstance("MP4_REMUXER");return e&&null!==e._audioDtsBase?e._audioDtsBase:this.dtsBase}},{key:"videoDtsBase",get:function(){var e=this._context.getInstance("MP4_REMUXER");return e&&null!==e._videoDtsBase?e._videoDtsBase:this.dtsBase}}])&&u(t.prototype,i),r&&u(t,r),e}()},34817:(e,t,i)=>{i.d(t,{Z:()=>d});var r=i(99631);function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,i=[{key:"EBSP2RBSP",value:function(e){return e.filter((function(t,i){return i<2||!(0===e[i-2]&&0===e[i-1]&&3===t)}))}},{key:"EBSP2SODB",value:function(e){var t=e[e.byteLength-1];return t&&128===t?e.slice(0,e.byteLength-1):e}}],null&&a(t.prototype,null),i&&a(t,i),e}();function s(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(e){for(var t="",i=0;i<e.byteLength;i++)t+=String.fromCharCode(e[i]);return t};const u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,i=[{key:"_resolveNalu",value:function(e){return e.length>=1?n.EBSP2SODB(n.EBSP2RBSP(e.slice(1))):null}},{key:"parse",value:function(t){var i=e._resolveNalu(t),r=e.switchPayloadType(i),a=r.payloadType,n=r.offset,s=i.slice(n);return 5===a?e.user_data_unregistered(s):{code:a,content:s}}},{key:"switchPayloadType",value:function(e){for(var t=new DataView(e.buffer),i=0,r=0;255===t.getUint8(r);)r++,i+=255;return{payloadType:i+=t.getUint8(r++),offset:r}}},{key:"getPayloadLength",value:function(e){for(var t=new DataView(e.buffer),i=0,r=0;255===t.getUint8(r);)r++,i+=255;return{payloadLength:i+=t.getUint8(r++),offset:r}}},{key:"user_data_unregistered",value:function(t){var i=e.getPayloadLength(t),r=i.payloadLength,a=i.offset;if(r<16)return{uuid:"",content:null};var n=t.slice(a);return{code:5,uuid:o(n.slice(0,16)),content:o(n.slice(16,r))}}}],null&&s(t.prototype,null),i&&s(t,i),e}();function l(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,i=[{key:"getNalunits",value:function(t){if(t.length-t.position<4)return[];var i=t.dataview,r=t.position;return 1===i.getInt32(r)||0===i.getInt16(r)&&1===i.getInt8(r+2)?e.getAnnexbNals(t):e.getHvccNals(t)}},{key:"getAnnexbNals",value:function(t){for(var i=[],r=e.getHeaderPositionAnnexB(t),a=r.pos,n=a;a<t.length-4;){var s=t.buffer.slice(a,a+r.headerLength);r.pos===t.position&&t.skip(r.headerLength),n=(r=e.getHeaderPositionAnnexB(t)).pos;var o={header:s,body:new Uint8Array(t.buffer.slice(a+s.byteLength,n))};e.analyseNal(o),o.type<=40&&i.push(o),t.skip(n-t.position),a=n}return i}},{key:"getHvccNals",value:function(t){for(var i=[];t.position<t.length-4;){var r=t.dataview.getInt32(t.dataview.position);if(!(t.length-t.position>=r))break;var a=t.buffer.slice(t.position,t.position+4);t.skip(4);var n=new Uint8Array(t.buffer.slice(t.position,t.position+r));t.skip(r);var s={header:a,body:n};try{e.analyseNal(s)}catch(e){continue}s.type<=40&&i.push(s)}return i}},{key:"analyseNal",value:function(e){var t=e.body[0]>>>1&63;switch(e.type=t,t){case 0:e.slice_trail_n=!0;break;case 1:e.slice_trail_r=!0;break;case 2:e.slice_tsa_n=!0;break;case 3:e.slice_tsa_r=!0,e.key=!0;break;case 4:e.slice_stsa_n=!0;break;case 5:e.slice_stsa_r=!0,e.key=!0;break;case 6:e.slice_radl_n=!0;break;case 7:e.slice_radl_r=!0,e.key=!0;break;case 8:e.slice_rasl_n=!0;break;case 9:e.slice_rasl_r=!0,e.key=!0;break;case 16:e.slice_bla_w_lp=!0;break;case 17:e.slice_bla_w_radl=!0;break;case 18:e.slice_bla_n_lp=!0;break;case 19:e.slice_idl_w_radl=!0,e.key=!0;break;case 20:e.slice_idr_n_lp=!0,e.key=!0;break;case 21:e.slice_cra_nut=!0,e.key=!0;break;case 32:e.vps=!0;break;case 33:e.sps=r.Z.parseSPS(e.body);break;case 34:e.pps=!0;break;case 35:default:break;case 36:e.aud=!0;break;case 37:e.eob=!0;break;case 38:e.fd=!0;break;case 39:try{e.sei=u.parse(e.body.slice(1))}catch(e){}break;case 40:e.sei=u.parse(e.body.slice(1))}}},{key:"getHeaderPositionAnnexB",value:function(e){for(var t=e.position,i=0,r=e.length;3!==i&&4!==i&&t<r-4;)0===e.dataview.getInt16(t)?1===e.dataview.getInt16(t+2)?i=4:1===e.dataview.getInt8(t+2)?i=3:t++:t++;return t===r-4&&(0===e.dataview.getInt16(t)?1===e.dataview.getInt16(t+2)?i=4:t=r:(t++,0===e.dataview.getInt16(t)&&1===e.dataview.getInt8(t)?i=3:t=r)),{pos:t,headerLength:i}}}],null&&l(t.prototype,null),i&&l(t,i),e}()},99631:(e,t,i)=>{function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}i.d(t,{Z:()=>s});const a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="Golomb",this._buffer=t,this._bufferIndex=0,this._totalBytes=t.byteLength,this._totalBits=8*t.byteLength,this._currentWord=0,this._currentWordBitsLeft=0}var t,i;return t=e,(i=[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._totalBytes-this._bufferIndex,t=Math.min(4,e),i=new Uint8Array(4);i.set(this._buffer.subarray(this._bufferIndex,this._bufferIndex+t)),this._currentWord=new DataView(i.buffer).getUint32(0),this._bufferIndex+=t,this._currentWordBitsLeft=8*t}},{key:"readBits",value:function(e){var t=Math.min(this._currentWordBitsLeft,e),i=this._currentWord>>>32-t;if(e>32)throw new Error("Cannot read more than 32 bits at a time");return this._currentWordBitsLeft-=t,this._currentWordBitsLeft>0?this._currentWord<<=t:this._totalBytes-this._bufferIndex>0&&this._fillCurrentWord(),(t=e-t)>0&&this._currentWordBitsLeft?i<<t|this.readBits(t):i}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e;for(e=0;e<this._currentWordBitsLeft;e++)if(0!=(this._currentWord&2147483648>>>e))return this._currentWord<<=e,this._currentWordBitsLeft-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}},{key:"readSliceType",value:function(){return this.readByte(),this.readUEG(),this.readUEG()}}])&&r(t.prototype,i),e}();function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,i=[{key:"_ebsp2rbsp",value:function(e){for(var t=e,i=t.byteLength,r=new Uint8Array(i),a=0,n=0;n<i;n++)n>=2&&3===t[n]&&0===t[n-1]&&0===t[n-2]||(r[a]=t[n],a++);return new Uint8Array(r.buffer,0,a)}},{key:"parseSPS",value:function(t){var i,r,n,s,o,u,l=e._ebsp2rbsp(t),d=new a(l),c=0,h=0,f=0,p=0,v=0,y=0,m=0,g=0,_=0;return d.readByte(),d.readByte(),d.readBits(4),i=d.readBits(3),d.readBits(1),u=e._readProfileTierLevel(d,i),d.readUEG(),3===(r=d.readUEG())&&(c=d.readBits(1)),h=d.readUEG(),f=d.readUEG(),1===(n=d.readBits(1))&&(p=d.readUEG(),v=d.readUEG(),y=d.readUEG(),m=d.readUEG()),s=d.readUEG(),o=d.readUEG(),1===n&&(h-=(g=1!==r&&2!==r||0!==c?1:2)*v+g*p,f-=(_=1===r&&0===c?2:1)*m+_*y),d.destroy(),d=null,{width:h,height:f,general_profile_space:u.general_profile_space,general_tier_flag:u.general_tier_flag,general_profile_idc:u.general_profile_idc,general_level_idc:u.general_level_idc,chromaFormatIdc:r,bitDepthLumaMinus8:s,bitDepthChromaMinus8:o}}},{key:"_readProfileTierLevel",value:function(e,t){var i,r,a,n;i=e.readBits(2)||0,r=e.readBits(1)||0,a=e.readBits(5)||0,e.readBits(16),e.readBits(16),e.readBits(1),e.readBits(1),e.readBits(1),e.readBits(1),e.readBits(16),e.readBits(16),e.readBits(12),n=e.readBits(8)||0;for(var s=[],o=[],u=0;u<t;u++)s[u]=e.readBits(1),o[u]=e.readBits(1);t>0&&e.readBits(2*(8-t));for(var l=0;l<t;l++)0!==s[l]&&(e.readBits(2),e.readBits(1),e.readBits(5),e.readBits(16),e.readBits(16),e.readBits(4),e.readBits(16),e.readBits(16),e.readBits(12)),0!==o[l]&&e.readBits(8);return{general_profile_space:i,general_tier_flag:r,general_profile_idc:a,general_level_idc:n}}},{key:"_skipScalingList",value:function(e,t){for(var i=8,r=8,a=0;a<t;a++)0!==r&&(r=(i+e.readSEG()+256)%256),i=0===r?i:r}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}},{key:"toVideoMeta",value:function(e){var t={};return e&&e.codec_size?(t.codecWidth=e.codec_size.width,t.codecHeight=e.codec_size.height,t.presentWidth=e.present_size.width,t.presentHeight=e.present_size.height):e.width&&e.height&&(t.codecWidth=e.width,t.codecHeight=e.height,t.presentWidth=e.width,t.presentHeight=e.height),t.profile=e.profile_string,t.level=e.level_string,t.bitDepth=e.bit_depth,t.chromaFormat=e.chroma_format,t}}],null&&n(t.prototype,null),i&&n(t,i),e}()},43614:(e,t,i)=>{function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}i.d(t,{Z:()=>a});const a=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(t instanceof ArrayBuffer))throw new Error("data is invalid");this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}var t,i,a;return t=e,a=[{key:"readByte",value:function(e,t,i){var r;switch(t){case 1:r=i?e.getInt8(e.position):e.getUint8(e.position);break;case 2:r=i?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(i)throw new Error("not supported for readByte 3");r=e.getUint8(e.position)<<16,r|=e.getUint8(e.position+1)<<8,r|=e.getUint8(e.position+2);break;case 4:r=i?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(i)throw new Error("not supported for readBody 8");r=e.getUint32(e.position)<<32,r|=e.getUint32(e.position+4);break;default:r=""}return e.position+=t,r}}],(i=[{key:"length",get:function(){return this.buffer.byteLength}},{key:"position",get:function(){return this.dataview.position},set:function(e){this.dataview.position=e}},{key:"back",value:function(e){this.position-=e}},{key:"getUint8",value:function(e){return this.dataview.getUint8(e)}},{key:"skip",value:function(t){for(var i=Math.floor(t/4),r=t%4,a=0;a<i;a++)e.readByte(this.dataview,4);r>0&&e.readByte(this.dataview,r)}},{key:"readUint8",value:function(){return e.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return e.readByte(this.dataview,2)}},{key:"readUint24",value:function(){return e.readByte(this.dataview,3)}},{key:"readUint32",value:function(){return e.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return e.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return e.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this.dataview,4,!0)}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}}])&&r(t.prototype,i),a&&r(t,a),e}()},30178:(e,t,i)=>{function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}i.d(t,{Z:()=>a});const a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0,this.fragLength=0,this._lastget=void 0,this.end=!1,this.autoclear=t.autoclear||!1,this.logger=t.logger,this.downloadedUrls=[],this._avgSegmentDuration=4}var t,i;return t=e,(i=[{key:"list",get:function(){return this._list}},{key:"baseURL",get:function(){return this._baseURL},set:function(e){this.baseURL!==e&&(this.clear(),this._baseURL=e)}},{key:"avgSegmentDuration",get:function(){return this._avgSegmentDuration}},{key:"push",value:function(e,t,i,r,a,n){this._ts[e]||(this._ts[e]={duration:t,downloaded:!1,downloading:!1,start:this.duration,discontinue:!!i,id:r,cc:a,isLast:n||!1},this._list[this.duration]=e,this.duration+=t,this.fragLength+=1)}},{key:"deleteFrag",value:function(e){this._ts[e]&&(this._ts[e].start>this._lastget.time&&(this._lastget={duration:this._ts[e].duration,time:this._ts[e].start,downloaded:!1,downloading:!1,url:e,id:this._ts[e].id}),delete this._list[this._ts[e].start],delete this._ts[e],this.fragLength-=1)}},{key:"_calcAvgFrgmentDuration",value:function(e){if(!e.frags)return e.targetduration;var t=e.frags.length;return Math.floor(e.duration/t/1e3)}},{key:"pushM3U8",value:function(e,t){if(!e)throw new Error("No m3u8 data received.");if(this.version=e.version,this.targetduration=e.targetduration,this._avgSegmentDuration=Math.min(this.targetduration,this._calcAvgFrgmentDuration(e)),e.encrypt&&!this.encrypt&&(this.encrypt=e.encrypt),this.end=e.end||!1,e.sequence||(e.sequence=0),!(e.sequence>this.sequence))throw new Error("Old m3u8 file received, ".concat(e.sequence));var i=e.frags.length;this.logger&&this.logger.log("PLAYLIST","new playlist [".concat(e.sequence,", ").concat(e.sequence+i-1,"]")),this.sequence=e.sequence;for(var r=[],a=0;a<i;a++){var n=e.frags[a];!this._ts[n.url]&&this.downloadedUrls.indexOf(n.url)<0&&(r.push(n.url),this.push(n.url,n.duration,n.discontinue,n.id,n.cc,n.isLast))}if(r.length<1)throw new Error("Can not read ts file list.");if(t)for(var s=this.getTsList(),o=0;o<s.length;o++)r.indexOf(s[o])<0&&this.deleteFrag(s[o])}},{key:"getTsList",value:function(){return Object.keys(this._ts)}},{key:"downloaded",value:function(e,t){var i=this._ts[e];i&&(i.downloaded=t)}},{key:"downloading",value:function(e,t){var i=this._ts[e];i&&(i.downloading=t)}},{key:"getTsByName",value:function(e){return this._ts[e]}},{key:"getTs",value:function(e){var t,i=Object.keys(this._list);if(void 0===e&&(e=this._lastget?this._lastget.time+this._lastget.duration:0),!(i.length<1||e>=this.duration)){i=i.sort((function(e,t){return parseFloat(e)-parseFloat(t)}));for(var r=0;r<i.length&&e>=parseInt(i[r]);r++){var a=this._list[i[r]];t={url:a,downloaded:this._ts[a].downloaded,downloading:this._ts[a].downloading,time:parseInt(i[r]),duration:parseInt(this._ts[a].duration),id:this._ts[a].id,cc:this._ts[a].cc,isLast:this._ts[a].isLast},this.autoclear&&this._lastget&&(delete this._ts[this._lastget.url],delete this._list[this._lastget.time]),this._lastget=t}return t&&this.downloadedUrls.push(t.url),t}}},{key:"getLastDownloadedTs",value:function(){for(var e,t=Object.keys(this._list).sort((function(e,t){return Number(e)-Number(t)})),i=0;i<t.length;i++){var r=this._list[t[i]],a=this._ts[r].downloaded,n=this._ts[r].downloading;if(!a)break;e={url:r,downloaded:a,downloading:n,time:parseInt(t[i]),duration:parseInt(this._ts[r].duration)}}return e}},{key:"clear",value:function(){this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0}},{key:"clearDownloaded",value:function(){for(var e=Object.keys(this._ts),t=0,i=e.length;t<i;t++){var r=this._ts[e[t]];r.downloaded=!1,r.downloading=!1}}},{key:"destroy",value:function(){this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0,this.fragLength=0,this._lastget=void 0,this.autoclear=!1}},{key:"resetSequence",value:function(){this.sequence=-1}}])&&r(t.prototype,i),e}()},52936:(e,t,i)=>{function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}i.d(t,{Z:()=>s});var n=function e(){a(this,e),this.mimetype="",this.init=null,this.data=[],this.bufferDuration=0};const s=function(){function e(){a(this,e),this.sources={}}var t,i;return t=e,(i=[{key:"getSource",value:function(e){return this.sources[e]}},{key:"createSource",value:function(e){return this.sources[e]=new n,this.sources[e]}},{key:"clear",value:function(){this.sources={}}},{key:"destroy",value:function(){this.clear()}}])&&r(t.prototype,i),e}()},50240:(e,t,i)=>{function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e}i.d(t,{h:()=>s,l:()=>o});var s=function(){function e(t){r(this,e);var i={sampleRate:48e3,channelCount:2,codec:"mp4a.40.2",config:[41,401,136,0],duration:0,id:2,refSampleDuration:21,sampleRateIndex:3,timescale:1e3,type:"audio"};return t?Object.assign({},i,t):i}return n(e,[{key:"destroy",value:function(){this.init=null}}]),e}(),o=function(){function e(t){r(this,e);var i={avcc:null,sps:new Uint8Array(0),pps:new Uint8Array(0),chromaFormat:420,codec:"avc1.640020",codecHeight:720,codecWidth:1280,duration:0,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},id:1,level:"3.2",presentHeight:720,presentWidth:1280,profile:"High",refSampleDuration:40,parRatio:{height:1,width:1},timescale:1e3,type:"video"};return t?Object.assign({},i,t):i}return n(e,[{key:"destroy",value:function(){this.init=null,this.sps=null,this.pps=null}}]),e}()},87911:(e,t,i)=>{function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e}i.d(t,{X:()=>s,_:()=>o});var s=function(){function e(t){r(this,e);var i=e.getDefault();return t?Object.assign({},i,t):i}return n(e,null,[{key:"getDefault",value:function(){return{dts:-1,pts:-1,originDts:-1,data:new Uint8Array}}}]),e}(),o=function(){function e(t){r(this,e);var i=e.getDefault();return t?Object.assign({},i,t):i}return n(e,null,[{key:"getDefault",value:function(){return{dts:-1,pts:void 0,isKeyframe:!1,originDts:-1,data:new Uint8Array,nals:[]}}}]),e}()},76645:(e,t,i)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}function n(e,t){return n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,a=o(e);if(t){var n=o(this).constructor;i=Reflect.construct(a,arguments,n)}else i=a.apply(this,arguments);return function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,i)}}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,i){return t&&l(e.prototype,t),i&&l(e,i),e}i.d(t,{WP:()=>h,ZP:()=>c,qT:()=>f});var c=function(){function e(){u(this,e),this.id=-1,this.sequenceNumber=0,this.samples=[],this.droppedSamples=[],this.length=0}return d(e,[{key:"reset",value:function(){this.sequenceNumber=0,this.samples=[],this.length=0}},{key:"destroy",value:function(){this.reset(),this.id=-1}}]),e}(),h=function(e){a(i,e);var t=s(i);function i(){var e;return u(this,i),(e=t.call(this)).TAG="AudioTrack",e.type="audio",e}return i}(c),f=function(e){a(i,e);var t=s(i);function i(){var e;return u(this,i),(e=t.call(this)).TAG="VideoTrack",e.type="video",e.dropped=0,e.sequenceNumber=0,e}return d(i,[{key:"reset",value:function(){this.sequenceNumber=0,this.samples=[],this.length=0,this.dropped=0}}]),i}(c)},72861:(e,t,i)=>{function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}i.d(t,{Z:()=>a});const a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.length=t||0,this.historyLen=t||0,this.array=[],this.offset=0}var t,i;return t=e,(i=[{key:"push",value:function(e){this.array.push(e),this.length+=e.byteLength,this.historyLen+=e.byteLength}},{key:"shift",value:function(e){if(this.array.length<1)return new Uint8Array(0);if(void 0===e)return this._shiftBuffer();if(this.offset+e===this.array[0].length){var t=this.array[0].slice(this.offset,this.offset+e);return this.offset=0,this.array.shift(),this.length-=e,t}if(this.offset+e<this.array[0].length){var i=this.array[0].slice(this.offset,this.offset+e);return this.offset+=e,this.length-=e,i}for(var r=new Uint8Array(e),a=0;this.array.length>0&&e>0;){if(this.offset+e<this.array[0].length){var n=this.array[0].slice(this.offset,this.offset+e);r.set(n,a),this.offset+=e,this.length-=e,e=0;break}var s=this.array[0].length-this.offset;r.set(this.array[0].slice(this.offset,this.array[0].length),a),this.array.shift(),this.offset=0,a+=s,this.length-=s,e-=s}return r}},{key:"clear",value:function(){this.array=[],this.length=0,this.offset=0}},{key:"destroy",value:function(){this.clear(),this.historyLen=0}},{key:"_shiftBuffer",value:function(){return this.length-=this.array[0].length,this.offset=0,this.array.shift()}},{key:"toInt",value:function(e,t){for(var i=0,r=this.offset+e;r<this.offset+t+e;){var a;r<(null===(a=this.array[0])||void 0===a?void 0:a.length)?i=256*i+this.array[0][r]:this.array[1]&&(i=256*i+this.array[1][r-this.array[0].length]),r++}return i}}])&&r(t.prototype,i),e}()},84955:(e,t,i)=>{i.d(t,{Z:()=>$});var r,a=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.filtered=-1,this.tagType=-1,this.datasize=-1,this.dts=-1},n=i(50240),s=i(87911),o=i(43614),u=i(9767),l=i(54659),d=i(99631),c=i(34817),h=(r=new ArrayBuffer(2),new DataView(r).setInt16(0,256,!0),256===new Int16Array(r)[0]),f={get device(){var e=f.os;return e.isPc?"pc":e.isTablet?"tablet":"mobile"},get browser(){var e=window.navigator.userAgent.toLowerCase(),t={ie:/rv:([\d.]+)\) like gecko/,firfox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(t).filter((function(i){return t[i].test(e)})))[0]},get os(){var e=window.navigator.userAgent,t=/(?:Windows Phone)/.test(e),i=/(?:SymbianOS)/.test(e)||t,r=/(?:Android)/.test(e),a=/(?:Firefox)/.test(e),n=/(?:iPad|PlayBook)/.test(e)||r&&!/(?:Mobile)/.test(e)||a&&/(?:Tablet)/.test(e),s=/(?:iPhone)/.test(e)&&!n;return{isTablet:n,isPhone:s,isAndroid:r,isPc:!s&&!r&&!i,isSymbian:i,isWindowsPhone:t,isFireFox:a}},get isLe(){return h}};const p=f;function v(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,i=[{key:"decode",value:function(t){for(var i=[],r=t,a=0,n=t.length;a<n;)if(r[a]<128)i.push(String.fromCharCode(r[a])),++a;else{if(r[a]<192);else if(r[a]<224){if(e._checkContinuation(r,a,1)){var s=(31&r[a])<<6|63&r[a+1];if(s>=128){i.push(String.fromCharCode(65535&s)),a+=2;continue}}}else if(r[a]<240){if(e._checkContinuation(r,a,2)){var o=(15&r[a])<<12|(63&r[a+1])<<6|63&r[a+2];if(o>=2048&&55296!=(63488&o)){i.push(String.fromCharCode(65535&o)),a+=3;continue}}}else if(r[a]<248&&e._checkContinuation(r,a,3)){var u=(7&r[a])<<18|(63&r[a+1])<<12|(63&r[a+2])<<6|63&r[a+3];if(u>65536&&u<1114112){u-=65536,i.push(String.fromCharCode(u>>>10|55296)),i.push(String.fromCharCode(1023&u|56320)),a+=4;continue}}i.push(String.fromCharCode(65533)),++a}return i.join("")}},{key:"_checkContinuation",value:function(e,t,i){var r=e;if(t+i<r.length){for(;i--;)if(128!=(192&r[++t]))return!1;return!0}return!1}}],null&&v(t.prototype,null),i&&v(t,i),e}();function m(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g=p.isLe,_=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.offset=0,this.readOffset=this.offset}var t,i;return t=e,(i=[{key:"resolve",value:function(e,t){if(t<3)throw new Error("not enough data for metainfo");var i={},r=this.parseValue(e),a=this.parseValue(e,t-r.bodySize);return i[r.data]=a.data,this.resetStatus(),i}},{key:"resetStatus",value:function(){this.offset=0,this.readOffset=this.offset}},{key:"parseString",value:function(e){var t,i=new DataView(e,this.readOffset).getUint16(0,!g);t=i>0?y.decode(new Uint8Array(e,this.readOffset+2,i)):"";var r=i+2;return this.readOffset+=r,{data:t,bodySize:i+2}}},{key:"parseDate",value:function(e,t){var i=new DataView(e,this.readOffset,t),r=i.getFloat64(0,!g);return r+=60*i.getInt16(8,!g)*1e3,this.readOffset+=10,{data:new Date(r),bodySize:10}}},{key:"parseObject",value:function(e,t){var i=this.parseString(e,t),r=this.parseValue(e,t-i.bodySize);return{data:{name:i.data,value:r.data},bodySize:i.bodySize+r.bodySize,isObjEnd:r.isObjEnd}}},{key:"parseLongString",value:function(e){var t,i=new DataView(e,this.readOffset).getUint32(0,!g);return t=i>0?y.decode(new Uint8Array(e,this.readOffset+2,i)):"",this.readOffset+=i+4,{data:t,bodySize:i+4}}},{key:"parseValue",value:function(e,t){var i=new ArrayBuffer;i=e instanceof ArrayBuffer?e:e.buffer;var r=new DataView(i,this.readOffset,t),a=!1,n=r.getUint8(0),s=1;this.readOffset+=1;var o=null;switch(n){case 0:o=r.getFloat64(1,!g),this.readOffset+=8,s+=8;break;case 1:o=!!r.getUint8(1),this.readOffset+=1,s+=1;break;case 2:var u=this.parseString(i);o=u.data,s+=u.bodySize;break;case 3:o={};var l=0;for(16777215&r.getUint32(t-4,!g)&&(l=3);s<t-4;){var d=this.parseObject(i,t-s-l);if(d.isObjectEnd)break;o[d.data.name]=d.data.value,s+=d.bodySize}s<=t-3&&9==(16777215&r.getUint32(s-1,!g))&&(this.readOffset+=3,s+=3);break;case 8:o={},s+=4,this.readOffset+=4;var c=0;for(9==(16777215&r.getUint32(t-4,!g))&&(c=3);s<t-8;){var h=this.parseObject(i,t-s-c);if(h.isObjectEnd)break;o[h.data.name]=h.data.value,s+=h.bodySize}s<=t-3&&9==(16777215&r.getUint32(s-1,!g))&&(s+=3,this.readOffset+=3);break;case 9:o=null,a=!0;break;case 10:o=[];var f=r.getUint32(1,!g);s+=4,this.readOffset+=4;for(var p=0;p<f;p++){var v=this.parseValue(i,t-s);o.push(v.data),s+=v.bodySize}break;case 11:var y=this.parseDate(i,t-1);o=y.data,s+=y.bodySize;break;case 12:var m=this.parseLongString(i,t-1);o=m.data,s+=m.bodySize;break;default:s=t}return{data:o,bodySize:s,isObjEnd:a}}}])&&m(t.prototype,i),e}(),b=i(76154),E=i.n(b);function S(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var A=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),k(this,"_bytesAvailable",void 0),k(this,"_bitsAvailable",0),k(this,"_word",0),!t)throw new Error("ExpGolomb data params is required");this._data=t,this._bytesAvailable=t.byteLength,this._bytesAvailable&&this._loadWord()}var t,i;return t=e,(i=[{key:"_loadWord",value:function(){var e=this._data.byteLength-this._bytesAvailable,t=Math.min(4,this._bytesAvailable);if(0===t)throw new Error("No bytes available");var i=new Uint8Array(4);i.set(this._data.subarray(e,e+t)),this._word=new DataView(i.buffer).getUint32(0),this._bitsAvailable=8*t,this._bytesAvailable-=t}},{key:"bitsPos",value:function(){return 8*this._bytesAvailable-this._bitsAvailable}},{key:"bitsLeft",value:function(){return 8*this._data.length-this.bitsPos()}},{key:"byteAligned",value:function(){return 0===this.bitsPos()||this.bitsPos()%8==0}},{key:"skipBits",value:function(e){if(this._bitsAvailable>e)this._word<<=e,this._bitsAvailable-=e;else{e-=this._bitsAvailable;var t=Math.floor(e/8);e-=8*t,this._bytesAvailable-=t,this._loadWord(),this._word<<=e,this._bitsAvailable-=e}}},{key:"readBits",value:function(e){if(e>32)throw new Error("Cannot read more than 32 bits");var t=Math.min(this._bitsAvailable,e),i=this._word>>>32-t;return this._bitsAvailable-=t,this._bitsAvailable>0?this._word<<=t:this._bytesAvailable>0&&this._loadWord(),(t=e-t)>0&&this._bitsAvailable?i<<t|this.readBits(t):i}},{key:"skipLZ",value:function(){var e;for(e=0;e<this._bitsAvailable;++e)if(0!=(this._word&2147483648>>>e))return this._word<<=e,this._bitsAvailable-=e,e;return this._loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(e){for(var t=8,i=8,r=0;r<e;r++)0!==i&&(i=(t+this.readEG()+256)%256),t=0===i?t:i}}])&&S(t.prototype,i),e}();function T(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function D(e){for(var t=e.byteLength,i=[],r=1;r<t-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(i.push(r+2),r+=2):r++;if(!i.length)return e;var a=t-i.length,n=new Uint8Array(a),s=0;for(r=0;r<a;s++,r++)s===i[0]&&(s++,i.shift()),n[r]=e[s];return n}var w=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,i=[{key:"parseHEVCDecoderConfigurationRecord",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(t.length<23)){i=i||{};for(var r,a,n,s,o,u=1+(3&t[21]),l=[],d=[],c=[],h=23,f=t[22],p=0;p<f;p++){n=63&t[h],s=t[h+1]<<8|t[h+2],h+=3;for(var v=0;v<s;v++)if(o=t[h]<<8|t[h+1],h+=2,o){switch(n){case 32:var y=t.subarray(h,h+o);r||(r=e.parseVPS(D(y),i)),c.push(y);break;case 33:var m=t.subarray(h,h+o);a||(a=e.parseSPS(D(m),i)),l.push(m);break;case 34:d.push(t.subarray(h,h+o))}h+=o}}return{hvcC:i,sps:a,spsArr:l,ppsArr:d,vpsArr:c,nalUnitSize:u}}}},{key:"parseVPS",value:function(t,i){i=i||{};var r=new A(t);r.readUByte(),r.readUByte(),r.readBits(12);var a=r.readBits(3);return i.numTemporalLayers=Math.max(i.numTemporalLayers||0,a+1),r.readBits(17),e._parseProfileTierLevel(r,a,i),i}},{key:"parseSPS",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i=i||{};var r=new A(t);r.readUByte(),r.readUByte(),r.readBits(4);var a=r.readBits(3);i.numTemporalLayers=Math.max(a+1,i.numTemporalLayers||0),i.temporalIdNested=r.readBits(1),e._parseProfileTierLevel(r,a,i),r.readUEG();var n=i.chromaFormatIdc=r.readUEG(),s=420;n<=3&&(s=[0,420,422,444][n]);var o=0;3===n&&(o=r.readBits(1));var u,l,d,c,h=r.readUEG(),f=r.readUEG(),p=r.readBits(1);return 1===p&&(u=r.readUEG(),l=r.readUEG(),d=r.readUEG(),c=r.readUEG()),i.bitDepthLumaMinus8=r.readUEG(),i.bitDepthChromaMinus8=r.readUEG(),1===p&&(h-=(1!==n&&2!==n||0!==o?1:2)*(l+u),f-=(1===n&&0===o?2:1)*(c+d)),{codec:"hev1.1.6.L93.B0",width:h,height:f,chromaFormat:s,hvcC:i}}},{key:"_parseProfileTierLevel",value:function(e,t,i){var r=i.generalTierFlag||0;i.generalProfileSpace=e.readBits(2),i.generalTierFlag=Math.max(e.readBits(1),r),i.generalProfileIdc=Math.max(e.readBits(5),i.generalProfileIdc||0),i.generalProfileCompatibilityFlags=e.readBits(32),i.generalConstraintIndicatorFlags=[e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8)];var a=e.readBits(8);r<i.generalTierFlag?i.generalLevelIdc=a:i.generalLevelIdc=Math.max(a,i.generalLevelIdc||0);for(var n=[],s=[],o=0;o<t;o++)n[o]=e.readBits(1),s[o]=e.readBits(1);t>0&&e.readBits(2*(8-t));for(var u=0;u<t;u++)0!==n[u]&&(e.readBits(2),e.readBits(1),e.readBits(5),e.readBits(16),e.readBits(16),e.readBits(4),e.readBits(16),e.readBits(16),e.readBits(12)),0!==s[u]&&e.readBits(8)}}],null&&T(t.prototype,null),i&&T(t,i),e}();function R(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function L(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function B(e,t,i){return t&&L(e.prototype,t),i&&L(e,i),e}var x=i(35461).Z,C=function(){function e(t){R(this,e),this._buffer=t,this._offset=0,this._heldBits=0,this._numHeldBits=0}return B(e,[{key:"readUint8",value:function(){return this._buffer[this._offset++]}},{key:"readUint16",value:function(){return this._buffer[this._offset++]<<8|this._buffer[this._offset++]}},{key:"readUint32",value:function(){return this._buffer[this._offset++]<<24|this._buffer[this._offset++]<<16|this._buffer[this._offset++]<<8|this._buffer[this._offset++]}},{key:"readUint8Array",value:function(e){var t=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,t}},{key:"streamRead1Bytes",value:function(){this._heldBits=this.readUint8(),this._numHeldBits=8}},{key:"streamRead2Bytes",value:function(){this._heldBits=this.readUint16(),this._numHeldBits=16}},{key:"extractBits",value:function(e){var t=this._heldBits>>this._numHeldBits-e&(1<<e)-1;return this._numHeldBits-=e,t}}]),e}(),O=function(){function e(){R(this,e)}return B(e,null,[{key:"parseVVCDecoderConfigurationRecord",value:function(t){var i=new C(t);i.streamRead1Bytes(),i.extractBits(5);var r,a,n,s,o,u,l,d,c=i.extractBits(2)+1,h=i.extractBits(1),f={};h&&(i.streamRead2Bytes(),r=i.extractBits(9),a=i.extractBits(3),n=i.extractBits(2),s=i.extractBits(2),i.streamRead1Bytes(),o=i.extractBits(3),i.extractBits(5),f=e.parseVVCPTLRecord(i,a),u=i.readUint16(),l=i.readUint16(),d=i.readUint16());for(var p=i.readUint8(),v=[],y=[],m=[],g=null,_=0;_<p;_++){i.streamRead1Bytes(),i.extractBits(1),i.extractBits(2);var b=i.extractBits(5),E=1;13!==b&&12!==b&&(E=i.readUint16());for(var S=0;S<E;S++){var k=i.readUint16();switch(b){case 14:v.push(i.readUint8Array(k));break;case 15:var A=i.readUint8Array(k);g||(g=e.parseSPS(e.removeEPB(A))),y.push(A);break;case 16:m.push(i.readUint8Array(k))}}}var T={vvcC:t,nalUnitSize:c,ptlPresentFlag:h,olsIdx:r,numSublayers:a,constantFrameRate:n,chromaFormatIdc:s,bitDepthLumaMinus8:o,ptlRecord:f,maxPictrueWidth:u,maxPictureHeight:l,avgFrameRate:d,numOfArrays:p,vpsArr:v,spsArr:y,ppsArr:m,spsParsed:g};return console.log("parseVVCDecoderConfigurationRecord:",t),console.log(T),T}},{key:"parseVVCPTLRecord",value:function(e,t){e.streamRead2Bytes(),e.extractBits(2);var i=e.extractBits(6),r=e.extractBits(7),a=e.extractBits(1),n=e.readUint8();e.streamRead1Bytes();var s=e.extractBits(1),o=e.extractBits(1),u=new Uint8Array(i);if(i){for(var l=0;l<i-1;l++){var d=e.extractBits(6);e.streamRead1Bytes();var c=e.extractBits(2);u[l]=d<<2|c}u[i-1]=e.extractBits(6)}else e.extractBits(6);var h=[];if(t>1){e.streamRead1Bytes();for(var f=0,p=t-2;p>=0;--p)f|=e.extractBits(1)<<p;for(var v=t;v<=8&&t>1;++v)e.extractBits(1);for(var y=t-2;y>=0;--y)f&1<<y&&(h[y]=e.readUint8())}var m=e.readUint8(),g=[];if(m)for(var _=0;_<m;_++)g.push(e.readUint32());return{generalProfileIdc:r,generalTierFlag:a,generalLevelIdc:n,ptlFrameOnlyConstraintFlag:s,ptlMultilayerEnabledFlag:o,generalConstraintInfo:u,subLayerLevelIdc:h,generalSubProfileIdc:g,ptlNumSubProfiles:m,numBytesConstraintInfo:i}}},{key:"getAvccNals",value:function(e){for(var t=[];e.position<e.length-4;){var i=e.dataview.getInt32(e.dataview.position);if(!(e.length-e.position>=i))break;var r=e.buffer.slice(e.position,e.position+4);e.skip(4);var a=new Uint8Array(e.buffer.slice(e.position,e.position+i));e.skip(i),t.push({header:r,body:a})}return t}},{key:"analyseNal",value:function(e){var t=(248&e.body[1])>>3;switch(e.type=t,t){case 23:case 24:try{e.sei=x.parse(e.body.slice(1))}catch(e){}break;case 7:case 8:e.key=!0;break;case 14:e.vps=!0;break;case 15:e.sps=!0;break;case 16:e.pps=!0;break;case 17:e.aps=!0}}},{key:"removeEPB",value:function(e){for(var t=e.byteLength,i=[],r=1;r<t-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(i.push(r+2),r+=2):r++;if(!i.length)return e;var a=t-i.length,n=new Uint8Array(a),s=0;for(r=0;r<a;s++,r++)s===i[0]&&(s++,i.shift()),n[r]=e[s];return n}},{key:"parseVps",value:function(){}},{key:"parseSPS",value:function(t){console.log(t);var i=new A(t);i.readUByte(),i.readUByte(),i.skipBits(4);var r=i.readBits(4),a=i.readBits(3),n=i.readBits(2),s=420;n<=3&&(s=[0,420,422,444][n]),i.readBits(2),i.readBits(1);var o=e._parseProfileTierLevel(i,1,a);return i.readBits(1),i.readBits(1)&&i.readBits(1),{width:i.readUEG(),height:i.readUEG(),spsMaxSubLayerMinus1:a,spsVideoParameterSetId:r,chromaFormatIdc:n,chromaFormat:s,ptlInfo:o}}},{key:"_parseProfileTierLevel",value:function(t,i,r){var a,n=t.readBits(7),s=t.readBits(1),o=t.readBits(8),u=t.readBits(1),l=t.readBits(1);i&&(a=e._parseGeneralConstraintsInfo(t));for(var d=r-1,c=[],h=[],f=[],p=d;p>=0;--p)c[p]=t.readBits(1);for(;!t.byteAligned();)t.readBits(1);for(var v=d;v>=0;--v)c[v]&&(h[v]=t.readUByte());if(i)for(var y=t.readUByte(),m=0;m<y;m++)f[m]=t.readBits(32);return{generalProfileIdc:n,generalTierFlag:s,generalLevelIdc:o,ptlFrameOnlyConstraintFlag:u,ptlMultilayerEnabledFlag:l,ptlSublayerLevelPresentFlags:c,ptlSublayerLevelIdcs:h,ptlSubProfileIdcs:f,gciInfo:a}}},{key:"_parseGeneralConstraintsInfo",value:function(e){var t=e.readBits(1);if(t){e.skipBits(71);var i=e.readBits(8);i&&e.skipBits(i)}var r=8-e.bitsPos()%8;return e.skipBits(r),{gciPresentFlag:t}}}]),e}();function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function U(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function P(e,t,i){return P="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=G(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(i):a.value}},P(e,t,i||e)}function M(e,t){return M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},M(e,t)}function G(e){return G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},G(e)}var V=u.Z,F=l.Z,N=d.Z,j=c.Z,H=[19,20,21],Z=[5],z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}(c,e);var t,i,r,u,l,d=(u=c,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=G(u);if(l){var i=G(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==I(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function c(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(e=d.call(this))._headerParsed=!1,e._gopId=0,e._videoRecentMetadata=null,e._onMetaData=null,e._audioMetaParsed=!1,e._vSeqHeaderIndex=0,e._userAgent="undefined"==typeof window?"":window.navigator.userAgent.toLowerCase()||"",e}return t=c,i=[{key:"foundAudioMetaFromScriptTag",get:function(){var e,t;return(null===(e=this._onMetaData)||void 0===e?void 0:e.audiosamplerate)&&(null===(t=this._onMetaData)||void 0===t?void 0:t.audiochannels)}},{key:"demux",value:function(e){if(this._headerParsed){if(e.length<11)return;var t,i=1e4;do{t=this._parseFlvTag(e)}while(t&&i-- >0)}else{if(e.length<13)return;var r=e.shift(13);this.parseFlvHeader(r),this.demux(e)}}},{key:"parseFlvHeader",value:function(e){if(!c.isFlvFile(e))throw new Error("invalid flv file,".concat(e.join(",")));this._headerParsed=!0;var t=e[4]>>>2==1,i=1==(1&e[4]);this.emit(c.EVENTS.FILE_HEADER_PARSED,{hasVideo:i,hasAudio:t})}},{key:"_parseFlvTag",value:function(e){var t=e.toInt(1,3);if(e.length<11+t+4)return null;var i=this._parseFlvTagHeader(e);if(i&&(this._processTagData(i,e),!this._datasizeValidator(i.datasize,e)))throw new Error("TAG length error at "+i.datasize);return i}},{key:"_parseFlvTagHeader",value:function(e){var t=0,i=new a,r=e.toInt(t,1);if(t+=1,i.filtered=(32&r)>>>5,i.tagType=31&r,i.datasize=e.toInt(t,3),t+=3,8!==i.tagType&&9!==i.tagType&&11!==i.tagType&&18!==i.tagType)throw e&&e.length>0&&e.shift(1),new Error("tagType "+i.tagType);if(e.length<i.datasize+15)return null;e.shift(4);var n=e.toInt(0,3);e.shift(3);var s=e.shift(1)[0];return s>0&&(n+=16777216*s),i.dts=n,e.shift(3),i}},{key:"_processTagData",value:function(e,t){switch(e.tagType){case 18:this._parseScriptData(e,t);break;case 8:this._parseAudioTag(e,t);break;case 9:this._parseVideoData(e,t);break;case 11:t.shift(3);break;default:t.shift(1)}}},{key:"_parseScriptData",value:function(e,t){e.data=t.shift(e.datasize);var i=(new _).resolve(e.data,e.data.length);this._onMetaData=i?i.onMetaData:void 0,this.emit(c.EVENTS.SCRIPT_TAG_PARSED,this._onMetaData)}},{key:"_aacSequenceHeaderParser",value:function(e){var t,i,r={hasSpecificConfig:!0};r.objectType=e[1]>>>3,r.originObjectType=r.objectType,r.sampleRateIndex=(7&e[1])<<1|e[2]>>>7,r.audiosamplerate=this._switchAudioSampleRate(r.sampleRateIndex),r.channelCount=(120&e[2])>>>3,r.frameLength=(4&e[2])>>>2,r.dependsOnCoreCoder=(2&e[2])>>>1,r.extensionFlagIndex=1&e[2];var a=r.sampleRateIndex;return this._userAgent&&-1!==this._userAgent.indexOf("firefox")?r.sampleRateIndex>=8?(r.objectType=5,i=new Array(4),t=a-3):(r.objectType=2,i=new Array(2),t=a):this._userAgent&&-1!==this._userAgent.indexOf("android")||this._userAgent&&-1!==this._userAgent.indexOf("iphone")?(r.objectType=2,i=new Array(2),t=a):(r.objectType=5,t=r.sampleRateIndex,i=new Array(4),r.sampleRateIndex>=6?t=r.sampleRateIndex-3:1===r.channelCount&&(r.objectType=2,i=new Array(2),t=r.sampleRateIndex)),r.codec="mp4a.40.".concat(r.objectType),i[0]=r.objectType<<3,i[0]|=(15&r.sampleRateIndex)>>>1,i[1]=(15&r.sampleRateIndex)<<7,i[1]|=(15&r.channelCount)<<3,5===r.objectType&&(i[1]|=(15&t)>>>1,i[2]=(1&t)<<7,i[2]|=8,i[3]=0),r.config=i,r}},{key:"_parseAudioTag",value:function(e,t){var i=new n.h,r=t.shift(1)[0];e.data=t.shift(e.datasize-1);var a=(240&r)>>>4;if(10!==a)throw new Error("invalid audio format: ".concat(a));10===a&&(i.sampleRate=this._switchAudioSamplingFrequency(r),i.sampleRateIndex=(12&r)>>>2,i.frameLenth=(2&r)>>>1,i.channelCount=1&r,i.refSampleDuration=Math.floor(1024/i.audioSampleRate*i.timescale));var s=i.audioSampleRate,o=i.sampleRateIndex,u=i.refSampleDuration;if(0===e.data[0]){var l=this._aacSequenceHeaderParser(e.data);s=l.audiosamplerate||i.audioSampleRate,o=l.sampleRateIndex||i.sampleRateIndex,u=Math.floor(1024/s*i.timescale),i.channelCount=l.channelCount,i.sampleRate=s,i.sampleRateIndex=o,i.refSampleDuration=u,i.duration=this._onMetaData?this._onMetaData.duration*i.timescale:0,i.config=l.config,i.objectType=l.objectType,i.originObjectType=l.originObjectType,this.emit(c.EVENTS.AUDIO_META_PARSED,i),this._audioMetaParsed=!0}else{if(!this._audioMetaParsed&&!this.foundAudioMetaFromScriptTag)throw new Error("flv stream without audio metadata detected");e.data=e.data.slice(1,e.data.length),this.emit(c.EVENTS.AUDIO_SAMPLE_PARSED,e)}}},{key:"_parseVideoData",value:function(e,t){var i=t.shift(1)[0],r=new s._(e),a=(240&i)>>>4;r.isKeyframe=1===a;var n=15&i;if(e.avcPacketType=t.shift(1)[0],r.cts=t.toInt(0,3),r.cts=r.cts<<8>>8,t.shift(3),7!==n&&12!==n&&14!==n)throw new Error("video codeid is ".concat(n));var u,l=12===n,d=14===n,h=t.shift(e.datasize-5);if(0===h[4]&&0===h[5]&&0===h[6]&&1===h[7]){for(var f=0,p=0;p<4;p++)f=256*f+h[p];f-=4,(h=h.slice(4,h.length))[3]=f%256,f=(f-h[3])/256,h[2]=f%256,f=(f-h[2])/256,h[1]=f%256,h[0]=(f-h[1])/256}if(h.length)if(r.data=h,0===e.avcPacketType)(u=l?this._hevcSequenceHeaderParser(h):d?this._vvcSequenceHeaderParser(h):this._avcSequenceHeaderParser(h)).codecID=n,this._videoRecentMetadata=u,this._vSeqHeaderIndex++,this.emit(c.EVENTS.VIDEO_META_PARSED,u);else{for(var v=new o.Z(h.buffer),y=d?O.getAvccNals(v):l?j.getHvccNals(v):F.getAvccNals(v),m=l?H:Z,g=!1,_=0;_<y.length;_++){var b=y[_];d?O.analyseNal(b):l?j.analyseNal(b):F.analyseNal(b),b.sps&&(g=!0),b.sei&&this.emit(c.EVENTS.VIDEO_SEI_PARSED,Object.assign(b.sei,{dts:e.dts})),m&&m.indexOf(b.type)>-1&&(r.firstInGop=!0,this._gopId++)}if(this._vSeqHeaderIndex>1&&this._videoRecentMetadata&&r.firstInGop&&!g){var E,S,k,A=this._videoRecentMetadata.hvcCConfigParsed;A?(E=A.vpsArr[A.vpsArr.length-1],S=A.spsArr[A.spsArr.length-1],k=A.ppsArr[A.ppsArr.length-1]):(E=this._videoRecentMetadata.vps,S=this._videoRecentMetadata.sps,k=this._videoRecentMetadata.pps);var T=[E?[0,0,E.length>>8,E.length%256]:0,E,[0,0,S.length>>8,S.length%256],S,[0,0,k.length>>8,k.length%256],k,r.data].filter(Boolean),D=T.reduce((function(e,t){return e+t.length}),0),w=new Uint8Array(D),R=0;T.forEach((function(e){w.set(e,R),R+=e.length})),this._videoRecentMetadata=null,r.data=w}r.gopId=this._gopId,r.nals=y,this.emit(c.EVENTS.VIDEO_SAMPLE_PARSED,r)}}},{key:"_avcSequenceHeaderParser",value:function(e){var t,i=0,r=new n.l;r.configurationVersion=e[0],r.avcProfileIndication=e[1],r.profileCompatibility=e[2],r.avcLevelIndication=e[3]/10,r.nalUnitLength=1+(3&e[4]);var a=31&e[5];i=6;for(var s={},o=0;o<a;o++){var u=255*e[i]+e[i+1];i+=2;for(var l=new Uint8Array(u),d=0;d<u;d++)l[d]=e[i+d];for(var c="avc1.",h=1;h<4;h++){var f=l[h].toString(16);f.length<2&&(f="0"+f),c+=f}r.codec=c,i+=u,r.sps=l,s=V.parseSPS(l)}var p=e[i];i++;for(var v=0;v<p;v++){var y=255*e[i]+e[i+1];i+=2;for(var m=new Uint8Array(y),g=0;g<y;g++)m[g]=e[i+g];i+=y,r.pps=m}return Object.assign(r,V.toVideoMeta(s)),r.duration=(null===(t=this._onMetaData)||void 0===t?void 0:t.duration)*r.timescale,r.avcc=new Uint8Array(e.length),r.avcc.set(e),r.streamType=27,r}},{key:"_hevcSequenceHeaderParser",value:function(e){var t,i=new n.l;try{t=w.parseHEVCDecoderConfigurationRecord(e)}catch(e){}var r=0;i.hvcCConfigParsed=t,i.configurationVersion=e[0],i.hevcProfileSpace=(192&e[1])>>>6,i.hevcTierFlag=(32&e[1])>>>5,i.hevcProfileIdc=31&e[1],i.hevcProfileCompatibilityFlags=[e[2],e[3],e[4],e[5]],i.hevcConstraintIndicatorFlags=[e[6],e[7],e[8],e[9],e[10],e[11]],i.hevcLevelIdc=e[12],i.minSpatialSegmentationIdc=e[13]&15+e[14]<<4,i.parallelismType=3&e[15],i.chromaFormat=3&e[16],i.bitDepthLumaMinus8=7&e[17],i.bitDepthChromaMinus8=7&e[18],i.avgFrameRate=256*e[19]+e[20],i.constantFrameRate=(192&e[21])>>>6,i.numTemporalLayers=(56&e[21])>>>3,i.temporalIdNested=(4&e[21])>>>2,i.lengthSizeMinusOne=3&e[21];var a=e[22];r=23;for(var s,o,u,l={},d=0,c=0,h=0,f=!1,p=!1,v=!1,y=0;y<a;y++){d=63&e[r],c=256*e[r+1]+e[r+2],r+=3;for(var m=0;m<c;m++){switch(h=256*e[r]+e[r+1],d){case 32:f||(f=!0,s=e.slice(r+2,r+2+h),i.vps=N._ebsp2rbsp(s),i.rawVps=s);break;case 33:p||(p=!0,o=e.slice(r+2,r+2+h),i.sps=N._ebsp2rbsp(o),i.rawSps=o,i.codec="hev1.1.6.L93.B0",l=N.parseSPS(o));break;case 34:v||(v=!0,u=e.slice(r+2,r+2+h),i.pps=N._ebsp2rbsp(u),i.rawPps=u)}r+=2+h}}return Object.assign(i,N.toVideoMeta(l)),i.streamType=36,i}},{key:"_vvcSequenceHeaderParser",value:function(e){var t,i,r=O.parseVVCDecoderConfigurationRecord(e),a=new n.l;return a.presentHeight=a.codecHeight=(null===(t=r.spsParsed)||void 0===t?void 0:t.height)||r.maxPictureHeight,a.presentWidth=a.codecWidth=(null===(i=r.spsParsed)||void 0===i?void 0:i.width)||r.maxPictrueWidth,a.sps=r.spsArr,a.pps=r.ppsArr,a.vps=r.vpsArr,a.codec="vvc1.1.6.L93.B0",a.vvcC=r.vvcC,a.vvcCConfigParsed=r,a}},{key:"_switchAudioSampleRate",value:function(e){return[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][e]}},{key:"_switchAudioSamplingFrequency",value:function(e){return[5500,11025,22050,44100,48e3][(12&e)>>>2]}},{key:"_switchAudioChannel",value:function(e){return[1,2][1&e]}},{key:"_datasizeValidator",value:function(e,t){var i=t.toInt(0,4);return t.shift(4),i===e+11}},{key:"destroy",value:function(){P(G(c.prototype),"removeAllListeners",this).call(this)}}],r=[{key:"EVENTS",get:function(){return{FILE_HEADER_PARSED:"FILE_HEADER_PARSED",SCRIPT_TAG_PARSED:"SCRIPT_TAG_PARSED",AUDIO_META_PARSED:"AUDIO_META_PARSED",VIDEO_META_PARSED:"VIDEO_META_PARSED",VIDEO_SAMPLE_PARSED:"VIDEO_SAMPLE_PARSED",AUDIO_SAMPLE_PARSED:"AUDIO_SAMPLE_PARSED",VIDEO_SEI_PARSED:"VIDEO_SEI_PARSED"}}},{key:"isFlvFile",value:function(e){return!(70!==e[0]||76!==e[1]||86!==e[2]||1!==e[3])}},{key:"getPlayType",value:function(e){var t={hasVideo:!1,hasAudio:!1};return!0&e&&(t.hasVideo=!0),!0&e&&(t.hasAudio=!0),t}}],i&&U(t.prototype,i),r&&U(t,r),c}(E());const W=z;var X=i(76645);function q(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var K=i(91780).Z.DEMUX_EVENTS,Y=W.EVENTS,Q=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="FLV_DEMUXER",this._cfg=t,this._firstFragmentLoaded=!1,this._trackNum=0,this._hasScript=!1,this._videoMetaChange=!1,this._audioMetaChange=!1,this._hasVideoSequence=!1,this._hasAudioSequence=!1,this._onMetaData=null,this.demuxer=new W}var t,i,r;return t=e,r=[{key:"getPlayType",value:function(e){var t={hasVideo:!1,hasAudio:!1};return!0&e&&(t.hasVideo=!0),!0&e&&(t.hasAudio=!0),t}}],(i=[{key:"init",value:function(){this.on(K.DEMUX_START,this.demux.bind(this)),this.demuxer.on(Y.FILE_HEADER_PARSED,this.handleFileHeaderParsed.bind(this)),this.demuxer.on(Y.SCRIPT_TAG_PARSED,this.handleScriptTagParsed.bind(this)),this.demuxer.on(Y.AUDIO_META_PARSED,this.handleAudioMetaParsed.bind(this)),this.demuxer.on(Y.VIDEO_META_PARSED,this.handleVideoMetaParsed.bind(this)),this.demuxer.on(Y.VIDEO_SAMPLE_PARSED,this.handleVideoSampleParsed.bind(this)),this.demuxer.on(Y.AUDIO_SAMPLE_PARSED,this.handleAudioSampleParsed.bind(this)),this.demuxer.on(Y.VIDEO_SEI_PARSED,this.handleSeiParsed.bind(this))}},{key:"handleAudioMetaParsed",value:function(e){this._cfg.onlyVideo||this.tracks&&this.tracks.audioTrack&&(this._context.mediaInfo.hasAudio=!0,this.tracks.audioTrack.meta=e,this.tracks.audioTrack.hasSpecificConfig=!0,e.channelCount?this._hasAudioSequence?this.emit(K.AUDIO_METADATA_CHANGE,"audio"):this.emit(K.METADATA_PARSED,"audio"):this._context.mediaInfo.hasAudio=!1)}},{key:"handleVideoMetaParsed",value:function(e){this._cfg.onlyAudio||this.tracks&&this.tracks.videoTrack&&(this._onMetaData&&this._onMetaData.framerate&&e.frameRate&&(e.frameRate.fps=this._onMetaData.framerate),this._context.mediaInfo.hasVideo=!0,this.tracks.videoTrack.meta=e,this.tracks.videoTrack.hasSpecificConfig=!0,this._hasVideoSequence?this.emit(K.VIDEO_METADATA_CHANGE,"video"):(this.emit(K.METADATA_PARSED,"video"),this._hasVideoSequence=!0))}},{key:"handleSeiParsed",value:function(e){this.emit(K.SEI_PARSED,e)}},{key:"handleVideoSampleParsed",value:function(e){this._cfg.onlyAudio||this.tracks&&this.tracks.videoTrack&&(e.isKeyframe&&this.emit(K.ISKEYFRAME,e.dts+e.cts,e.cts),this.tracks.videoTrack.samples.push(e))}},{key:"handleAudioSampleParsed",value:function(e){var t;this._cfg.onlyVideo||this.tracks&&this.tracks.audioTrack&&null!==(t=this.tracks.audioTrack)&&void 0!==t&&t.meta.channelCount&&this.tracks.audioTrack.samples.push(e)}},{key:"handleScriptTagParsed",value:function(e){if(e){this._onMetaData=e;var t=this.tracks,i=t.videoTrack,r=t.audioTrack;if(this._context.mediaInfo.duration=e.duration,"boolean"==typeof e.hasAudio&&(this._context.mediaInfo.hsaAudio=!this._cfg.onlyVideo&&e.hasAudio),"boolean"==typeof e.hasVideo&&(this._context.mediaInfo.hasVideo=!this._cfg.onlyAudio&&e.hasVideo),this.emit(K.MEDIA_INFO),this._hasScript=!0,r&&!r.hasSpecificConfig){var a=r.meta;switch(e.audiosamplerate&&(a.sampleRate=e.audiosamplerate),e.audiochannels&&(a.channelCount=e.audiochannels),e.audiosamplerate){case 44100:a.sampleRateIndex=4;break;case 22050:a.sampleRateIndex=7;break;case 11025:a.sampleRateIndex=10}}if(i&&!i.hasSpecificConfig){var n=i.meta;if("number"==typeof e.framerate){var s=Math.floor(1e3*e.framerate);if(s>0){var o=s/1e3;n.frameRate||(n.frameRate={}),n.frameRate.fixed=!0,n.frameRate.fps=o,n.frameRate.fps_num=s,n.frameRate.fps_den=1e3}}}}}},{key:"handleFileHeaderParsed",value:function(e){var t=e.hasVideo,i=e.hasAudio;this._context.mediaInfo.hasVideo=!this._cfg.onlyAudio&&t,this._context.mediaInfo.hasAudio=!this._cfg.onlyVideo&&i,this.initVideoTrack(),this.initAudioTrack()}},{key:"demux",value:function(){if(this.loaderBuffer){try{this.demuxer.demux(this.loaderBuffer)}catch(e){return void this.emit(K.DEMUX_ERROR,this.TAG,e)}this.emit(K.DEMUX_COMPLETE)}}},{key:"initVideoTrack",value:function(){this._trackNum++;var e=new X.qT;e.meta=new n.l,e.id=e.meta.id=this._trackNum,this.tracks.videoTrack=e}},{key:"initAudioTrack",value:function(){this._trackNum++;var e=new X.WP;e.meta=new n.h,e.id=e.meta.id=this._trackNum,this.tracks.audioTrack=e}},{key:"loaderBuffer",get:function(){var e=this._context.getInstance("LOADER_BUFFER");if(e)return e;this.emit(K.DEMUX_ERROR,this.TAG,new Error("no found loaderBuffer"))}},{key:"tracks",get:function(){return this._context.getInstance("TRACKS")}},{key:"logger",get:function(){return this._context.getInstance("LOGGER")}},{key:"destroy",value:function(){this.demuxer&&this.demuxer.destroy()}}])&&q(t.prototype,i),r&&q(t,r),e}();const $=Q},58024:(e,t,i)=>{function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}i.d(t,{Z:()=>s});var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i=Object.assign({},e.getDefault(),t);this.id=i.id,this.url=i.url,this.start=i.start,this.duration=i.duration,this.discontinue=i.discontinue,this.cc=i.cc}var t,i;return t=e,i=[{key:"getDefault",value:function(){return{id:-1,url:"",start:-1,duration:-1,discontinue:!1,cc:-1}}}],null&&r(t.prototype,null),i&&r(t,i),e}();function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,i=[{key:"parse",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r={duration:0};if(!t||!t.includes("#EXTM3U"))throw new Error("Invalid m3u8 file");var a=t.split(/\r|\n/);a=a.filter((function(e){return e}));var n=a.shift();if(!n.match("#EXTM3U"))throw new Error('Invalid m3u8 file: not "#EXTM3U"');n=a.shift();for(var s=!1,o=0;n;){var u=n.match(/#(.[A-Z|-]*):(.*)/),l=n.match(/#(.[A-Z|-]*)/);if(l&&u&&u.length>2)switch(u[1]){case"EXT-X-VERSION":r.version=parseInt(u[2]);break;case"EXT-X-MEDIA-SEQUENCE":r.sequence=parseInt(u[2]);break;case"EXT-X-TARGETDURATION":r.targetduration=parseFloat(u[2]);break;case"EXTINF":o=e.parseFrag(u,a,r,i,s,o),s=!1;break;case"EXT-X-KEY":e.parseDecrypt(u[2],r)}if(l&&l.length>1)switch(l[1]){case"EXT-X-DISCONTINUITY":s=!0;break;case"EXT-X-ENDLIST":r.frags[r.frags.length-1].isLast=!0,r.end=!0}n=a[o++]}return r}},{key:"parseFrag",value:function(t,i,r,n,s,o){r.frags||(r.frags=[]);var u=new a({start:r.duration,duration:parseInt(1e3*parseFloat(t[2]))});if(u.duration<200)return o;r.duration+=u.duration;var l=i[o++];if((l.match(/#(.*):(.*)/)||l.match(/^#/))&&(l=i[o++]),l.length>0&&"/"===l.charAt(0)&&n.match(/.*\/\/.*\.\w+/g)&&(n=n.match(/.*\/\/.*\.\w+/g)[0]),l.match(/.*:\/\/.*/)){var d=e.isHTTPS;!e.envisHttps&&!(e.envisHttps=d(window.location.href))||d(l)||(l=l.replace("http:","https:")),u.url=l}else u.url=n+l;if(u.discontinue=s,r.frags.length){var c=r.frags[r.frags.length-1];u.id=c.id+1,u.cc=s?c.cc+1:c.cc}else u.id=r.sequence||1,u.cc=0;return r.frags.push(u),o}},{key:"parseURL",value:function(e){var t="",i=e.match(/(.*\/).*\.m3u8/);if(i&&i.length>0)for(var r=0;r<i.length;r++)i[r].match(/.*\/$/g)&&i[r].length>t.length&&(t=i[r]);return t}},{key:"parseDecrypt",value:function(e,t){t.encrypt={};var i=e.split(",");for(var r in i){var a=i[r];if(a.match(/METHOD=(.*)/)&&(t.encrypt.method=a.match(/METHOD=(.*)/)[1]),a.match(/URI="(.*)"/)&&(t.encrypt.uri=a.match(/URI="(.*)"/)[1]),a.match(/IV=0x(.*)/)){var n=a.match(/IV=0x(.*)/)[1],s=Math.ceil(n.length/2);t.encrypt.ivb=new Uint8Array(s);for(var o=s-1;o>=0;o--){var u=parseInt(n.substr(2*o,2),16);t.encrypt.ivb[o]=u}t.encrypt.iv=n}}}},{key:"isHTTPS",value:function(e){return/^https:\/\//i.test(e)}}],null&&n(t.prototype,null),i&&n(t,i),e}()},18098:(e,t,i)=>{i.d(t,{Z:()=>R});var r=i(91780),a=i(76645),n=i(76154),s=i.n(n),o=i(33971),u=i(43614),l=i(50240),d=i(87911),c=i(54659),h=i(34817);function f(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,i=[{key:"isHeader",value:function(t,i){return!!(i+1<t.length&&e.isHeaderPattern(t,i))}},{key:"getFrameDuration",value:function(e){return 9216e4/e}},{key:"isHeaderPattern",value:function(e,t){return 255===e[t]&&240==(246&e[t+1])}},{key:"getHeaderLength",value:function(e,t){return 1&e[t+1]?7:9}},{key:"getFullFrameLength",value:function(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}},{key:"parseFrameHeader",value:function(t,i,r,a,n){var s,o,u=t.length;if(s=e.getHeaderLength(t,i),o=e.getFullFrameLength(t,i),(o-=s)>0&&i+s+o<=u)return{headerLength:s,frameLength:o,stamp:r+a*n}}},{key:"appendFrame",value:function(t,i,r,a,n){var s=e.getFrameDuration(t),o=e.parseFrameHeader(i,r,a,n,s);if(o){var u=o.stamp,l=o.headerLength,d=o.frameLength;return{sample:{unit:i.subarray(r+l,r+l+d),pts:u,dts:u},length:d+l}}}}],null&&f(t.prototype,null),i&&f(t,i),e}();function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function m(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e,t){return g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},g(e,t)}function _(e){return _=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_(e)}var b=c.Z,E=h.Z,S={1:["video","MPEG-1"],2:["video","MPEG-2"],27:["video","AVC.H264"],36:["video","HVC.H265"],234:["video","VC-1"],3:["audio","MPEG-1"],4:["audio","MPEG-2"],15:["audio","MPEG-2.AAC"],17:["audio","MPEG-4.AAC"],128:["audio","LPCM"],129:["audio","AC3"],6:["audio","AC3"],130:["audio","DTS"],131:["audio","Dolby TrueHD"],132:["audio","AC3-Plus"],133:["audio","DTS-HD"],134:["audio","DTS-MA"],161:["audio","AC3-Plus-SEC"],162:["audio","DTS-HD-SEC"]},k=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(c,e);var t,i,r,a,n,s=(a=c,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=_(a);if(n){var i=_(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function c(e){var t,i=e.videoTrack,r=e.audioTrack;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=s.call(this)).TAG="TsDemuxer",t.demuxing=!1,t.videoTrack=i,t.audioTrack=r,t.pat=[],t.pmt=[],t._hasVideoMeta=!1,t._hasAudioMeta=!1,t.gopId=0,t}return t=c,i=[{key:"demux",value:function(e,t,i){if(e&&o.Z.log(this.TAG,"do demux: id=".concat(e.id,",demuxing=").concat(this.demuxing)),!this.demuxing){for(var r={pat:[],pmt:[]},a={};t.length>=188;){if(t.length>=1&&71!==t.array[0][t.offset])throw new Error("Untrust sync code: ".concat(t.array[0][t.offset],", try to recover;"));for(;t.length>=1&&71!==t.array[0][t.offset];)t.shift(1);if(!(t.length<188)){var n=t.shift(188),s=new u.Z(n.buffer),l={};c.read(s,l,r);var d=a[l.header.pid];l.pes?(l.pes.codec=l.header.codec,l.pes.streamType=l.header.streamType,a[l.header.pid]||(a[l.header.pid]=[]),a[l.header.pid].push(l.pes),l.pes.ES.buffer=[l.pes.ES.buffer]):d&&d[d.length-1].ES.buffer.push(l.payload.stream)}}for(var h=Object.assign({},e),f=Object.assign({},e),p=i&&this._hasVideoMeta&&!this._hasAudioMeta,v=i&&this._hasAudioMeta&&!this._hasVideoMeta,y=0;y<Object.keys(a).length;y++)for(var m=a[Object.keys(a)[y]],g=0;g<m.length;g++){var _=m[g];_.id=Object.keys(a)[y];var b=15===_.streamType||17===_.streamType;"audio"===_.type&&!p&&b?(_.ES.buffer=c.mergeAudioES(_.ES.buffer),this.pushAudioSample(_,h),h={}):"video"!==_.type||v||(_.ES.buffer=c.mergeVideoES(_.ES.buffer),"HVC.H265"===_.codec?this.pushVideoSampleHEVC(m[g],f):this.pushVideoSample(m[g],f),f={})}}}},{key:"pushAudioSample",value:function(e,t){var i=new l.h({audioSampleRate:e.ES.frequence,sampleRate:e.ES.frequence,channelCount:e.ES.channel,codec:"mp4a.40."+e.ES.audioObjectType,originCodec:"mp4a.40."+e.ES.originAudioObjectType,originObjectType:e.ES.originAudioObjectType,config:e.ES.audioConfig,id:2,sampleRateIndex:e.ES.frequencyIndex});i.refSampleDuration=Math.floor(1024/i.audioSampleRate*i.timescale);var r=c.compareMeta(this.audioTrack.meta,i,!0);this._hasAudioMeta&&r||(this._hasAudioMeta=!0,t?t.meta=Object.assign({},i):t={meta:Object.assign({},i)},this.emit(c.EVENTS.METADATA_PARSED,"audio",i));var a=0;e.ES.buffer.skip(e.pesHeaderLength+9);for(var n=!1;e.ES.buffer.position<e.ES.buffer.length;)if(p.isHeader(new Uint8Array(e.ES.buffer.buffer),e.ES.buffer.position)&&e.ES.buffer.position+5<e.ES.buffer.length){var s=p.appendFrame(this.audioTrack.meta.sampleRate,new Uint8Array(e.ES.buffer.buffer),e.ES.buffer.position,e.pts,a);if(!s||!s.sample)break;e.ES.buffer.skip(s.length);var o=new d.X({dts:s.sample.dts,pts:s.sample.pts,data:s.sample.unit,options:n?{}:t});t.meta&&(n=!0),o.dts=o.pts=Math.ceil(o.pts/90),this.emit(c.EVENTS.AUDIO_SAMPLE_PARSED,o),a++}else e.ES.buffer.skip(1)}},{key:"pushVideoSample",value:function(e,t){for(var i=this,r=b.getNalunits(e.ES.buffer),a=new l.l,n=0,s=!1,o=!1,u=[],h=0;h<r.length;h++){var f=r[h];if(f.sps){s=f,a.sps=f.body,a.chromaFormat=s.sps.chroma_format,a.codec="avc1.";for(var p=1;p<4;p++){var v=s.body[p].toString(16);v.length<2&&(v="0"+v),a.codec+=v}a.codecHeight=s.sps.codec_size.height,a.codecWidth=s.sps.codec_size.width,a.frameRate=s.sps.frame_rate,a.id=1,a.level=s.sps.level_string,a.presentHeight=s.sps.present_size.height,a.presentWidth=s.sps.present_size.width,a.profile=s.sps.profile_string,a.refSampleDuration=Math.floor(a.timescale*(s.sps.frame_rate.fps_den/s.sps.frame_rate.fps_num)),a.sarRatio=s.sps.sar_ratio?s.sps.sar_ratio:s.sps.par_ratio}else f.pps?(a.pps=f.body,o=f):f.sei?u.push(f.sei):f.type<9&&(n+=4+f.body.byteLength)}if(s&&o){a.avcc=b.getAvcc(s.body,o.body);var y=c.compareMeta(this.videoTrack.meta,a,!0);this._hasVideoMeta&&y||(t?t.meta=Object.assign({},a):t={meta:Object.assign({},a)},this._hasVideoMeta=!0,this.emit(c.EVENTS.METADATA_PARSED,"video",a))}for(var m=new Uint8Array(n),g=0,_=!1,E=0;E<r.length;E++){var S=r[E];if(!(S.type&&S.type>=9)){var k=S.body.byteLength;S.idr&&(_=!0),S.pps||S.sps||S.sei||(m.set(new Uint8Array([k>>>24&255,k>>>16&255,k>>>8&255,255&k]),g),g+=4,m.set(S.body,g),g+=k)}}var A=parseInt(e.dts/90),T=parseInt(e.pts/90);u.length&&u.forEach((function(e){e.dts=A,i.emit(c.EVENTS.SEI_PARSED,e)}));var D=new d._({dts:A,pts:T,cts:T-A,originDts:e.dts,purePts:e.purePts,isKeyframe:_,data:m,nals:r,options:t,firstInGop:_,gopId:_?++this.gopId:this.gopId});this.emit(c.EVENTS.VIDEO_SAMPLE_PARSED,D)}},{key:"pushVideoSampleHEVC",value:function(e,t){var i=this,r=E.getNalunits(e.ES.buffer);r=r.filter((function(e){return e.body&&e.body.length}));var a=new l.l;a.streamType=36;for(var n=0,s=!1,o=!1,u=!1,h=[],f=!1,p=!1,v=!1,y=!1,m=0;m<r.length;m++){var g=r[m];if(g.vps){if(f)continue;f=!0}else if(g.sps){if(p)continue;p=!0}else if(g.pps){if(v)continue;v=!0}else if(g.key)20!==g.type&&19!==g.type||(y=!0);else if(0===g.type);else if(35===g.type)continue;g.sps?(o=g,a.sps=g.body,a.presentWidth=o.sps.width,a.presentHeight=o.sps.height,a.general_profile_space=o.sps.general_profile_space,a.general_tier_flag=o.sps.general_tier_flag,a.general_profile_idc=o.sps.general_profile_idc,a.general_level_idc=o.sps.general_level_idc,a.codec="hev1.1.6.L93.B0",a.chromaFormatIdc=o.sps.chromaFormatIdc,a.bitDepthLumaMinus8=o.sps.bitDepthLumaMinus8,a.bitDepthChromaMinus8=o.sps.bitDepthChromaMinus8):g.pps?(a.pps=g.body,u=g):g.vps?(a.vps=g.body,s=g):g.sei&&h.push(g.sei),g.type<=40&&(n+=4+g.body.byteLength)}if(o&&u&&s){var _=c.compareMeta(this.videoTrack.meta,a,!0);this._hasVideoMeta&&_||(t?t.meta=Object.assign({},a):t={meta:Object.assign({},a)},a.streamType=36,this.videoTrack.meta=a,this._hasVideoMeta=!0,this.emit(c.EVENTS.METADATA_PARSED,"video",a))}var b=new Uint8Array(n),S=0,k=!1;f=!1,p=!1,v=!1;for(var A=0;A<r.length;A++){var T=r[A];if(!(T.type&&T.type>40)){if(T.vps){if(f)continue;f=!0}else if(T.sps){if(p)continue;p=!0}else if(T.pps){if(v)continue;v=!0}else if(T.key);else if(0===T.type);else if(35===T.type)continue;var D=T.body.byteLength;T.key&&(k=!0),b.set(new Uint8Array([D>>>24&255,D>>>16&255,D>>>8&255,255&D]),S),S+=4,b.set(T.body,S),S+=D}}var w=parseInt(e.dts/90),R=parseInt(e.pts/90);h&&h.forEach((function(e){e.dts=w,i.emit(c.EVENTS.SEI_PARSED,e)}));var L=new d._({dts:w,pts:R,cts:R-w,originDts:e.dts,purePts:e.purePts,isKeyframe:k,data:b,nals:r,options:t,firstInGop:y,gopId:y?++this.gopId:this.gopId});this.emit(c.EVENTS.VIDEO_SAMPLE_PARSED,L)}},{key:"destroy",value:function(){this.removeAllListeners(),this.configs={},this.demuxing=!1,this.pat=[],this.pmt=[],this._hasVideoMeta=!1,this._hasAudioMeta=!1}}],r=[{key:"EVENTS",get:function(){return{DEMUX_COMPLETE:"DEMUX_COMPLETE",METADATA_PARSED:"METADATA_PARSED",VIDEO_SAMPLE_PARSED:"VIDEO_SAMPLE_PARSED",AUDIO_SAMPLE_PARSED:"AUDIO_SAMPLES_PARSED",SEI_PARSED:"SEI_PARSED"}}},{key:"compareArray",value:function(e,t,i){var r=0,a=0;if("Uint8Array"===i?(r=e.byteLength,a=t.byteLength):"Array"===i&&(r=e.length,a=t.length),r!==a)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}},{key:"compareMeta",value:function(e,t,i){if(!e||!t)return!1;for(var r=0,a=Object.keys(e).length;r<a;r++){var n=e[Object.keys(e)[r]],s=t[Object.keys(e)[r]];if(!n&&!s)return!0;if(null==n&&s||n&&void 0===s)return!1;if("object"!==y(n)){if(i&&"duration"!==Object.keys(e)[r]&&"refSampleDuration"!==Object.keys(e)[r]&&"refSampleDurationFixed"!==Object.keys(e)[r]&&n!==s)return!1}else if(void 0!==n.byteLength){if(void 0===s.byteLength)return!1;if(!c.compareArray(n,s,"Uint8Array"))return!1}else if(void 0!==n.length){if(void 0===s.length)return!1;if(!c.compareArray(n,s,"Array"))return!1}else if(!c.compareMeta(n,s))return!1}return!0}},{key:"mergeVideoES",value:function(e){for(var t,i=0,r=0,a=0;a<e.length;a++)i+=e[a].length-e[a].position;t=new Uint8Array(i);for(var n=0;n<e.length;n++){var s=e[n];t.set(new Uint8Array(s.buffer,s.position),r),r+=s.length-s.position}return new u.Z(t.buffer)}},{key:"mergeAudioES",value:function(e){for(var t,i=0,r=0,a=0;a<e.length;a++)i+=e[a].length;t=new Uint8Array(i);for(var n=0;n<e.length;n++){var s=e[n];t.set(new Uint8Array(s.buffer),r),r+=s.length}return new u.Z(t.buffer)}},{key:"read",value:function(e,t,i){c.readHeader(e,t),c.readPayload(e,t,i),"MEDIA"!==t.header.packet||1!==t.header.payload||t.unknownPIDs||(t.pes=c.PES(t))}},{key:"readPayload",value:function(e,t,i){var r=t.header.pid;switch(r){case 0:c.PAT(e,t,i);break;case 1:c.CAT(e,t,i);break;case 2:c.TSDT(e,t,i);break;case 8191:break;default:for(var a=!1,n=0,s=i.pat.length;n<s;n++)if(i.pat[n].pid===r){a=!0;break}if(a)c.PMT(e,t,i);else{for(var o=[],u=0,l=i.pmt.length;u<l;u++)if(i.pmt[u].pid===r){o.push(i.pmt[u]);break}if(o.length>0){var d=o[0].streamType;c.Media(e,t,d)}else t.unknownPIDs=!0}}}},{key:"readHeader",value:function(e,t){var i={};i.sync=e.readUint8();var r=e.readUint16();i.error=r>>>15,i.payload=r>>>14&1,i.priority=r>>>13&1,i.pid=8191&r,r=e.readUint8(),i.scrambling=r>>6&3,i.adaptation=r>>4&3,i.continuity=15&r,i.packet=0===i.pid?"PAT":"MEDIA",t.header=i}},{key:"PAT",value:function(e,t,i){var r={},a=e.readUint8();e.skip(a),a=e.readUint8(),r.tabelID=a,a=e.readUint16(),r.error=a>>>7,r.zero=a>>>6&1,r.sectionLength=4095&a,r.streamID=e.readUint16(),r.current=1&e.readUint8(),r.sectionNumber=e.readUint8(),r.lastSectionNumber=e.readUint8();for(var n=(r.sectionLength-9)/4,s=[],o=0;o<n;o++){var u=e.readUint16(),l=8191&e.readUint16();s.push({program:u,pid:l,type:0===u?"network":"mapPID"})}s.length>0&&(i.pat=i.pat.concat(s)),r.list=s,r.program=e.readUint16(),r.pid=8191&e.readUint16(),t.payload=r}},{key:"PMT",value:function(e,t,i){t.header.packet="PMT";var r=e.position;r+=e.getUint8(r);var a=(r+=1)+3+((15&e.getUint8(r+1))<<8|e.getUint8(r+2))-4;r+=12+((15&e.getUint8(r+10))<<8|e.getUint8(r+11));for(var n=[];r<a;){var s=(31&e.getUint8(r+1))<<8|e.getUint8(r+2);n.push({streamType:e.getUint8(r),pid:s}),r+=5+((15&e.getUint8(r+3))<<8|e.getUint8(r+4))}i.pmt=n,e.skip(a+4)}},{key:"Media",value:function(e,t,i){var r=t.header,a={},n=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var r,a,n=[],s=!0,o=!1;try{for(i=i.call(e);!(s=(r=i.next()).done)&&(n.push(r.value),!t||n.length!==t);s=!0);}catch(e){o=!0,a=e}finally{try{s||null==i.return||i.return()}finally{if(o)throw a}}return n}}(e,t)||function(e,t){if(e){if("string"==typeof e)return v(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?v(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(S[i],2),s=n[0],o=n[1];if(r.streamType=i,r.type=s,r.codec=o,3===r.adaptation&&(a.adaptationLength=e.readUint8(),a.adaptationLength>0)){var l=e.readUint8();a.discontinue=l>>>7,a.access=l>>>6&1,a.priority=l>>>5&1,a.PCR=l>>>4&1,a.OPCR=l>>>3&1,a.splicePoint=l>>>2&1,a.transportPrivate=l>>>1&1,a.adaptationField=1&l;var d=e.position;if(1===a.PCR&&(a.programClockBase=e.readUint32()<<1,l=e.readUint16(),a.programClockBase|=l>>>15,a.programClockExtension=511&l),1===a.OPCR&&(a.originProgramClockBase=e.readUint32()<<1,l=e.readUint16(),a.originProgramClockBase+=l>>>15,a.originProgramClockExtension=511&l),1===a.splicePoint&&(a.spliceCountdown=e.readUint8()),1===a.transportPrivate)for(var c=e.readUint8(),h=[],f=0;f<c;f++)h.push(e.readUint8());if(1===a.adaptationField){var p=e.readUint8(),y=e.readUint8(),m=e.position,g=y>>>6&1,_=y>>>5&1;1==y>>>7&&(y=e.readUint16(),a.ltwValid=y>>>15,a.ltwOffset=61439&y),1===g&&(y=e.readUint24(),a.piecewiseRate=4194303&y),1===_&&(y=e.readInt8(),a.spliceType=y>>>4,a.dtsNextAU1=y>>>1&7,a.marker1=1&y,y=e.readUint16(),a.dtsNextAU2=y>>>1,a.marker2=1&y,y=e.readUint16(),a.dtsNextAU3=y),e.skip(p-1-(e.position-m))}var b=a.adaptationLength-1-(e.position-d);e.skip(b)}a.stream=new u.Z(e.buffer.slice(e.position)),t.payload=a}},{key:"PES",value:function(e){var t={},i=e.payload.stream;if(1!==i.readUint24())t.ES={},t.ES.buffer=i;else{var r=i.readUint8();r>=224&&r<=239&&(t.type="video"),r>=192&&r<=223&&(t.type="audio");var a=i.readUint16();if(t.packetLength=a,"video"!==t.type&&"audio"!==t.type)throw new Error("format is not supported");var n=i.readUint8();if(2!=n>>>6)throw new Error("error when parse pes header");n=i.readUint8(),t.ptsDTSFlag=n>>>6,t.escrFlag=n>>>5&1,t.esRateFlag=n>>>4&1,t.dsmFlag=n>>>3&1,t.additionalFlag=n>>>2&1,t.crcFlag=n>>>1&1,t.extensionFlag=1&n,t.pesHeaderLength=i.readUint8();var s=t.pesHeaderLength,o=[];o.push(i.readUint8()),o.push(i.readUint8()),o.push(i.readUint8()),o.push(i.readUint8()),o.push(i.readUint8());var u=536870912*(14&o[0])+4194304*(255&o[1])+16384*(254&o[2])+128*(255&o[3])+(254&o[4])/2;if(t.purePts=u,i.dataview.position-=5,o=[],n=i.readUint8(),o.push(n>>>1&7),n=i.readUint16(),o.push(n>>>1),n=i.readUint16(),o.push(n>>>1),t.pts=o[0]<<30|o[1]<<15|o[2],s-=5,"video"===t.type&&(t.dts=t.pts),3===t.ptsDTSFlag){var l=[];n=i.readUint8(),l.push(n>>>1&7),n=i.readUint16(),l.push(n>>>1),n=i.readUint16(),l.push(n>>>1),t.dts=l[0]<<30|l[1]<<15|l[2],s-=5}if(1===t.escrFlag){var d=[],h=[];n=i.readUint8(),d.push(n>>>3&7),d.push(3&n),n=i.readUint16(),d.push(n>>>13),d.push(3&n),n=i.readUint16(),d.push(n>>>13),h.push(3&n),n=i.readUint8(),h.push(n>>>1),t.escr=300*(d[0]<<30|d[1]<<28|d[2]<<15|d[3]<<13|d[4])+(h[0]<<7|h[1]),s-=6}if(1===t.esRateFlag&&(n=i.readUint24(),t.esRate=n>>>1&4194303,s-=3),1===t.dsmFlag)throw new Error("not support DSM_trick_mode");if(1===t.additionalFlag&&(n=i.readUint8(),t.additionalCopyInfo=127&n,s-=1),1===t.crcFlag&&(t.pesCRC=i.readUint16(),s-=2),1===t.extensionFlag)throw new Error("not support extension");s>0&&i.skip(s),t.dts>t.pts&&(t.dts=t.pts),t.ES=c.ES(i,t.type,e.header.streamType)}return t}},{key:"ES",value:function(e,t,i){var r={};if("video"===t)r.buffer=e;else{if("audio"!==t)throw new Error("ES ".concat(t," is not supported"));15!==i&&17!==i||(r=c.parseADTSHeader(e)),r.buffer=e}return r}},{key:"parseADTSHeader",value:function(e){var t={},i=e.readUint16();if(i>>>4!=4095)throw new Error("aac ES parse Error");return t.id=0==(i>>>3&1)?"MPEG-4":"MPEG-2",t.layer=i>>>1&3,t.absent=1&i,i=e.readUint16(),t.audioObjectType=1+(i>>>14&3),t.profile=t.audioObjectType-1,t.frequencyIndex=i>>>10&15,t.frequence=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][t.frequencyIndex],t.channel=i>>>6&7,t.frameLength=(3&i)<<11|e.readUint16()>>>5,c.getAudioConfig(t),e.skip(1),t.buffer=e,t}},{key:"TSDT",value:function(e,t,i){t.payload={}}},{key:"CAT",value:function(e,t,i){var r={};r.tableID=e.readUint8();var a=e.readUint16();r.sectionIndicator=a>>>7,r.sectionLength=4095&a,e.skip(2),a=e.readUint8(),r.version=a>>>3,r.currentNextIndicator=1&a,r.sectionNumber=e.readUint8(),r.lastSectionNumber=e.readUint8();for(var n=(this.sectionLength-9)/4,s=[],o=0;o<n;o++)s.push({});r.crc32=e.readUint32(),t.payload=r}},{key:"getAudioConfig",value:function(e){var t,i,r=window.navigator.userAgent.toLowerCase()||"";e.originAudioObjectType=e.audioObjectType,/firefox/i.test(r)?e.frequencyIndex>=8?(e.audioObjectType=5,t=new Array(4),i=e.frequencyIndex-3):(e.audioObjectType=2,t=new Array(2),i=e.frequencyIndex):-1!==r.indexOf("android")?(e.audioObjectType=2,t=new Array(2),i=e.frequencyIndex):(e.audioObjectType=5,t=new Array(4),e.frequencyIndex>=6?i=e.frequencyIndex-3:(1===e.channel&&(e.audioObjectType=2,t=new Array(2)),i=e.frequencyIndex)),t[0]=e.audioObjectType<<3,t[0]|=(14&e.frequencyIndex)>>1,t[1]=(1&e.frequencyIndex)<<7,t[1]|=e.channel<<3,5===e.audioObjectType&&(t[1]|=(14&i)>>1,t[2]=(1&i)<<7,t[2]|=8,t[3]=0),e.audioConfig=t}}],i&&m(t.prototype,i),r&&m(t,r),c}(s());const A=k;function T(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var D=r.Z.DEMUX_EVENTS,w=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.configs=Object.assign({},t),this.demuxer=null}var t,i;return t=e,(i=[{key:"init",value:function(){this.on(D.DEMUX_START,this.demux.bind(this))}},{key:"initDemuxer",value:function(){this.demuxer.on(A.EVENTS.METADATA_PARSED,this.onMetaDataParsed.bind(this)),this.demuxer.on(A.EVENTS.VIDEO_SAMPLE_PARSED,this.onVideoSampleParsed.bind(this)),this.demuxer.on(A.EVENTS.AUDIO_SAMPLE_PARSED,this.onAudioSampleParsed.bind(this)),this.demuxer.on(A.EVENTS.SEI_PARSED,this.emit.bind(this,D.SEI_PARSED))}},{key:"demux",value:function(e,t){if(this._tracks){this._tracks.audioTrack||(this._tracks.audioTrack=new a.WP),this._tracks.videoTrack||(this._tracks.videoTrack=new a.qT),this.demuxer||(this.demuxer=new A(this._tracks),this.initDemuxer());try{this.demuxer.demux(e,this.inputBuffer,t)}catch(e){this.emit(D.DEMUX_ERROR,this.TAG,e,!1)}var i=this._tracks.videoTrack&&this._tracks.videoTrack.samples.length?1:0,r=this._tracks.audioTrack&&this._tracks.audioTrack.samples.length?1:0;this.emit(D.DEMUX_COMPLETE,i,r)}}},{key:"onMetaDataParsed",value:function(e,t){var i=this._tracks,r=i.videoTrack,a=i.audioTrack,n=r;switch(e){case"video":default:n=r;break;case"audio":n=a}n.meta=t,this.emit(D.METADATA_PARSED,e,t)}},{key:"onVideoSampleParsed",value:function(e){e.isKeyframe&&this.emit(D.ISKEYFRAME,e.pts,e.pts-e.dts),this._tracks.videoTrack.samples.push(e)}},{key:"onAudioSampleParsed",value:function(e){this._tracks.audioTrack.samples.push(e)}},{key:"destroy",value:function(){this.off(D.DEMUX_START,this.demux),this.configs={},this.demuxer&&this.demuxer.destroy()}},{key:"inputBuffer",get:function(){return this._context.getInstance(this.configs.inputbuffer)}},{key:"_tracks",get:function(){return this._context.getInstance("TRACKS")}}])&&T(t.prototype,i),e}();const R=w},66802:(e,t,i)=>{i.d(t,{Z:()=>A});var r=i(91780),a=i(33971),n=i(76154),s=i.n(n),o=i(23204),u=i.n(o);function l(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.buffer=t||new Uint8Array(0)}var t,i,r;return t=e,i=[{key:"write",value:function(){for(var e=this,t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];i.forEach((function(t){e.buffer=u()(Uint8Array,e.buffer,t)}))}}],r=[{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}},{key:"readAsInt",value:function(e){var t="";return e.forEach((function(e){t+=e.toString(16).padStart(2,"0")})),parseInt(t,16)}}],i&&l(t.prototype,i),r&&l(t,r),e}();function c(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return h(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?h(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function f(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,i=[{key:"size",value:function(e){return d.writeUint32(e)}},{key:"initBox",value:function(t,i){for(var r=new d,a=arguments.length,n=new Array(a>2?a-2:0),s=2;s<a;s++)n[s-2]=arguments[s];return r.write.apply(r,[e.size(t),e.type(i)].concat(n)),r.buffer}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"ftyp",value:function(){return e.initBox(24,"ftyp",new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))}},{key:"ftypHEVC",value:function(){return e.initBox(24,"ftyp",new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,100,97,115,104]))}},{key:"moov",value:function(t){var i,r=t.type,a=t.meta,n=8,s=e.mvhd(a.duration,a.timescale);i="video"===r?e.videoTrak(a):e.audioTrak(a);var o=e.mvex(a.duration,a.timescale||1e3,a.id);return[s,i,o].forEach((function(e){n+=e.byteLength})),e.initBox(n,"moov",s,i,o)}},{key:"mvhd",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,r=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.initBox(8+r.length,"mvhd",new Uint8Array(r))}},{key:"videoTrak",value:function(t){var i=8,r=e.tkhd({id:1,duration:t.duration,timescale:t.timescale||1e3,width:t.presentWidth,height:t.presentHeight,type:"video"}),a=e.mdia({type:"video",timescale:t.timescale||1e3,duration:t.duration,avcc:t.avcc,vvcC:t.vvcC,hvcCConfigParsed:t.hvcCConfigParsed,parRatio:t.parRatio,width:t.presentWidth,height:t.presentHeight,streamType:t.streamType});return[r,a].forEach((function(e){i+=e.byteLength})),e.initBox(i,"trak",r,a)}},{key:"audioTrak",value:function(t){var i=8,r=e.tkhd({id:2,duration:t.duration,timescale:t.timescale||1e3,width:0,height:0,type:"audio"}),a=e.mdia({type:"audio",timescale:t.timescale||1e3,duration:t.duration,channelCount:t.channelCount,samplerate:t.sampleRate,config:t.config});return[r,a].forEach((function(e){i+=e.byteLength})),e.initBox(i,"trak",r,a)}},{key:"tkhd",value:function(t){var i=t.id,r=t.duration,a=t.width,n=t.height,s=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>>8&255,255&a,0,0,n>>>8&255,255&n,0,0]);return e.initBox(8+s.byteLength,"tkhd",s)}},{key:"edts",value:function(t){var i=new d,r=t.duration,a=t.mediaTime;return i.write(e.size(36),e.type("edts")),i.write(e.size(28),e.type("elst")),i.write(new Uint8Array([0,0,0,1,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24&255,a>>16&255,a>>8&255,255&a,0,0,0,1])),i.buffer}},{key:"mdia",value:function(t){var i=8,r=e.mdhd(t.timescale,t.duration),a=e.hdlr(t.type),n=e.minf(t);return[r,a,n].forEach((function(e){i+=e.byteLength})),e.initBox(i,"mdia",r,a,n)}},{key:"mdhd",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,i=arguments.length>1?arguments[1]:void 0,r=new Uint8Array([0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,i>>>24&255,i>>>16&255,i>>>8&255,255&i,85,196,0,0]);return e.initBox(12+r.byteLength,"mdhd",e.extension(0,0),r)}},{key:"hdlr",value:function(t){var i=[0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0];return"audio"===t&&(i.splice.apply(i,[8,4].concat([115,111,117,110])),i.splice.apply(i,[24,13].concat([83,111,117,110,100,72,97,110,100,108,101,114,0]))),e.initBox(8+i.length,"hdlr",new Uint8Array(i))}},{key:"minf",value:function(t){var i=8,r="video"===t.type?e.vmhd():e.smhd(),a=e.dinf(),n=e.stbl(t);return[r,a,n].forEach((function(e){i+=e.byteLength})),e.initBox(i,"minf",r,a,n)}},{key:"vmhd",value:function(){return e.initBox(20,"vmhd",new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))}},{key:"smhd",value:function(){return e.initBox(16,"smhd",new Uint8Array([0,0,0,0,0,0,0,0]))}},{key:"dinf",value:function(){var t=new d;return t.write(e.size(36),e.type("dinf"),e.size(28),e.type("dref"),new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])),t.buffer}},{key:"stbl",value:function(t){var i=8,r=e.stsd(t),a=e.stts(),n=e.stsc(),s=e.stsz(),o=e.stco();return[r,a,n,s,o].forEach((function(e){i+=e.byteLength})),e.initBox(i,"stbl",r,a,n,s,o)}},{key:"stsd",value:function(t){var i;return i="audio"===t.type?e.mp4a(t):36===t.streamType||t.vvcC?e.hvc1vvc1(t):e.avc1(t),e.initBox(16+i.byteLength,"stsd",e.extension(0,0),new Uint8Array([0,0,0,1]),i)}},{key:"mp4a",value:function(t){var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.samplerate>>8&255,255&t.samplerate,0,0]),r=e.esds(t.config);return e.initBox(8+i.byteLength+r.byteLength,"mp4a",i,r)}},{key:"esds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[43,146,8,0],i=t.length,r=new d,a=new Uint8Array([0,0,0,0,3,23+i,0,1,0,4,15+i,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([i]).concat(t).concat([6,1,2]));return r.write(e.size(8+a.byteLength),e.type("esds"),a),r.buffer}},{key:"avc1",value:function(t){var i=new d,r=t.width,a=t.height,n=t.parRatio.width,s=t.parRatio.height,o=t.avcc,u=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,r>>8&255,255&r,a>>8&255,255&a,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l=new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]),c=new Uint8Array([n>>24,n>>16&255,n>>8&255,255&n,s>>24,s>>16&255,s>>8&255,255&s]);return i.write(e.size(40+u.byteLength+o.byteLength+l.byteLength),e.type("avc1"),u,e.size(8+o.byteLength),e.type("avcC"),o,e.size(20),e.type("btrt"),l,e.size(16),e.type("pasp"),c),i.buffer}},{key:"hvc1vvc1",value:function(t){var i=new d,r=[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,255&t.width,t.height>>8&255,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17],a=!!t.vvcC,n=a?e.vvcC(t):e.hvcC(t),s=[e.type(a?"vvc1":"hvc1"),new Uint8Array(r)].concat(c(n));t.parRatio&&s.push.apply(s,c(e.pasp(t.parRatio)));var o=4+s.reduce((function(e,t){return e+t.byteLength}),0);return s.unshift(e.size(o)),i.write.apply(i,c(s)),i.buffer}},{key:"hvcC",value:function(t){var i;if(t.hvcCConfigParsed){var r=t.hvcCConfigParsed,a=r.vpsArr,n=r.spsArr,s=r.ppsArr,o=r.hvcC,u=o.generalProfileCompatibilityFlags,l=o.generalConstraintIndicatorFlags,d=(a.length&&1)+(n.length&&1)+(s.length&&1);i=[1,o.generalProfileSpace<<6|o.generalTierFlag<<5|o.generalProfileIdc,u>>>24,u>>>16,u>>>8,u,l[0],l[1],l[2],l[3],l[4],l[5],o.generalLevelIdc,240,0,252,252|o.chromaFormatIdc,248|o.bitDepthLumaMinus8,248|o.bitDepthChromaMinus8,0,0,o.numTemporalLayers<<3|o.temporalIdNested<<2|3,d];var h=function(e){var t;i.push(e.length>>8,e.length),(t=i).push.apply(t,c(e))};a.length&&(i.push(160,0,a.length),a.forEach(h)),n.length&&(i.push(161,0,n.length),n.forEach(h)),s.length&&(i.push(162,0,s.length),s.forEach(h))}else i=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return[e.size(8+i.length),e.type("hvcC"),new Uint8Array(i)]}},{key:"vvcC",value:function(t){var i=t.vvcC;return[e.size(8+i.byteLength),e.type("vvcC"),i]}},{key:"fiel",value:function(){return[e.size(10),e.type("fiel"),new Uint8Array([1,0])]}},{key:"pasp",value:function(t){if(t.width&&t.height){var i=t.width,r=t.height;return[e.size(16),e.type("pasp"),new Uint8Array([i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r])]}return[]}},{key:"stts",value:function(){var t=new Uint8Array([0,0,0,0,0,0,0,0]);return e.initBox(16,"stts",t)}},{key:"stsc",value:function(){var t=new Uint8Array([0,0,0,0,0,0,0,0]);return e.initBox(16,"stsc",t)}},{key:"stco",value:function(){var t=new Uint8Array([0,0,0,0,0,0,0,0]);return e.initBox(16,"stco",t)}},{key:"stsz",value:function(){var t=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);return e.initBox(20,"stsz",t)}},{key:"mvex",value:function(t){var i=arguments.length>2?arguments[2]:void 0,r=new d,a=d.writeUint32(t);return r.write(e.size(56),e.type("mvex"),e.size(16),e.type("mehd"),e.extension(0,0),a,e.trex(i)),r.buffer}},{key:"trex",value:function(t){var i=new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.initBox(8+i.byteLength,"trex",i)}},{key:"moof",value:function(t){var i=8,r=e.mfhd(),a=e.traf(t);return[r,a].forEach((function(e){i+=e.byteLength})),e.initBox(i,"moof",r,a)}},{key:"mfhd",value:function(){var t=d.writeUint32(e.sequence);return e.sequence+=1,e.initBox(16,"mfhd",e.extension(0,0),t)}},{key:"traf",value:function(t){var i=8,r=e.tfhd(t.id),a=e.tfdt(t.time),n=e.sdtp(t),s=e.trun(t,n.byteLength);return[r,a,s,n].forEach((function(e){i+=e.byteLength})),e.initBox(i,"traf",r,a,s,n)}},{key:"tfhd",value:function(t){var i=d.writeUint32(t);return e.initBox(16,"tfhd",e.extension(0,0),i)}},{key:"tfdt",value:function(t){return e.initBox(16,"tfdt",e.extension(0,0),d.writeUint32(t))}},{key:"trun",value:function(t,i){var r=new d,a=d.writeUint32(t.samples.length),n=d.writeUint32(92+16*t.samples.length+i);return r.write(e.size(20+16*t.samples.length),e.type("trun"),new Uint8Array([0,0,15,1]),a,n),t.samples.forEach((function(e){var t=e.flags;r.write(new Uint8Array([e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,255&e.duration,e.size>>>24&255,e.size>>>16&255,e.size>>>8&255,255&e.size,t.isLeading<<2|t.dependsOn,t.isDependedOn<<6|t.hasRedundancy<<4|t.isNonSync,0,0,e.cts>>>24&255,e.cts>>>16&255,e.cts>>>8&255,255&e.cts]))})),r.buffer}},{key:"sdtp",value:function(t){var i=new d;return i.write(e.size(12+t.samples.length),e.type("sdtp"),e.extension(0,0)),t.samples.forEach((function(e){var t=e.flags,r=t.isLeading<<6|t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;i.write(new Uint8Array([r]))})),i.buffer}},{key:"mdat",value:function(t){var i=new d,r=8;t.samples.forEach((function(e){r+=e.size})),i.write(e.size(r),e.type("mdat"));var a=new Uint8Array(r),n=0;return a.set(i.buffer,n),n+=8,t.samples.forEach((function(e){e.buffer.forEach((function(e){a.set(e,n),n+=e.byteLength}))})),a}}],null&&f(t.prototype,null),i&&f(t,i),e}();p.type=function(e){return new Uint8Array([e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)])},p.sequence=1;const v=p;function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function m(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e,t){return g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},g(e,t)}function _(e){return _=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_(e)}var b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(u,e);var t,i,r,n,s,o=(n=u,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=_(n);if(s){var i=_(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function u(e){var t,i=e.videoMeta,r=e.audioMeta,a=e.curTime;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=o.call(this)).TAG="Fmp4Remuxer",t._dtsBase=1e3*a,t._videoMeta=i,t._audioMeta=r,t._audioDtsBase=null,t._videoDtsBase=null,t._isDtsBaseInited=!1,t.isFirstVideo=!0,t.isFirstAudio=!0,t.videoAllDuration=0,t.audioAllDuration=0,t.audioRemuxed=0,t.videoRemuxed=0,t.mp4Durations={keys:[]};var n=/Chrome\/([^.]+)/.exec(navigator.userAgent);return t.forceFirstIDR=n&&Number(n[1])<50,t}return t=u,r=[{key:"EVENTS",get:function(){return{MEDIA_SEGMENT:"MEDIA_SEGMENT",INIT_SEGMENT:"INIT_SEGMENT",RANDOM_ACCESS_POINT:"RANDOM_ACCESS_POINT",TRACK_REMUXED:"TRACK_REMUXED"}}}],(i=[{key:"destroy",value:function(){this._dtsBase=-1,this._isDtsBaseInited=!1,this.mp4Durations={keys:[]},this.removeAllListeners()}},{key:"remux",value:function(e,t){!this._isDtsBaseInited&&this.calcDtsBase(e,t),this.remuxVideo(t),this.remuxAudio(e),a.Z.groupEnd()}},{key:"resetDtsBase",value:function(){this._dtsBase=0}},{key:"seek",value:function(e){a.Z.log(this.TAG,"set dtsBase for seek(),time=",e),this._isDtsBaseInited?(this._isDtsBaseInited=!1,this._dtsBase=1e3*e):this._dtsBase=1e3*e,this._audioDtsBase=this._videoDtsBase=null}},{key:"remuxInitSegment",value:function(e,t){a.Z.log(this.TAG,"remuxInitSegment: type=",e,t);var i=new d,r=36===t.streamType?v.ftypHEVC():v.ftyp(),n=v.moov({type:e,meta:t});return i.write(r,n),i}},{key:"calcDtsBase",value:function(e,t){if(!e&&t.samples.length){var i,r=t.samples[0];return r.options&&r.options.start&&(i=r.options.start),this._videoDtsBase=r.dts-(i||this._dtsBase),void(this._isDtsBaseInited=!0)}if(e&&e.samples.length||t&&t.samples.length){var n=null,s=null,o=null;if(e&&e.samples&&e.samples.length){var u=e.samples[0];n=u.dts,u.options&&u.options.start&&(o=u.options.start)}if(t&&t.samples&&t.samples.length){var l=t.samples[0];s=l.dts,l.options&&l.options.start&&(o=l.options.start)}var d=n-s;d<0&&null!==o&&t.samples.forEach((function(e){e.dts-=d,e.pts&&(e.pts-=d)})),this._videoDtsBase=(s||n)-(o||this._dtsBase),this._audioDtsBase=(n||s)-(o||this._dtsBase),this._dtsBase=Math.min(s,n),this._isDtsBaseInited=!0,a.Z.log(this.TAG,"calcDtsBase"),a.Z.log(this.TAG,"video first dts: ".concat(s," , start:").concat(o," , _videoDtsBase:").concat(this._videoDtsBase," , _dtsBase:").concat(this._dtsBase)),a.Z.log(this.TAG,"audio first dts: ".concat(n," , start:").concat(o," , _audioDtsBase:").concat(this._audioDtsBase,", _dtsBase:").concat(this._dtsBase))}}},{key:"remuxVideo",value:function(e){var t=this,i=e||{};if(e&&e.samples&&e.samples.length){var r=i.samples;if(i.meta){for(var n=-1,s=null,o=[],l={samples:[]},c=1e4,h=!0;r.length&&c-- >0;){var f=r.shift(),p=f.isKeyframe,y=f.options;if(!this.isFirstVideo&&y&&y.meta){s=this.remuxInitSegment("video",y.meta),y.meta=null,r.unshift(f),y.isContinue||(this._videoDtsBase=0);break}var m=Math.max(0,f.dts-this.videoDtsBase);-1===n&&(n=m);var g=void 0,_=void 0;void 0!==f.pts&&(g=(_=f.pts-this._dtsBase)-m),void 0!==f.cts&&(_=f.cts+m,g=f.cts);var b,E={buffer:[],size:0};b=f.duration?f.duration:r.length>=1?r[0].dts-this.videoDtsBase-m:o.length>=1?o[o.length-1].duration:this._videoMeta.refSampleDuration,this.videoAllDuration+=b,a.Z.long&&a.Z.log(this.TAG,"video dts ".concat(m),"pts ".concat(_),"cts: ".concat(g),p,"originDts ".concat(f.originDts),"duration ".concat(b),h),b>=0&&(l.samples.push(E),E.buffer.push(f.data),E.size+=f.data.byteLength,o.push({dts:m,cts:g,pts:_,data:f.data,size:f.data.byteLength,isKeyframe:p,duration:b,flags:{isLeading:0,dependsOn:p||this.forceFirstIDR&&h?2:1,isDependedOn:p?1:0,hasRedundancy:0,isNonSync:p||this.forceFirstIDR&&h?0:1},originDts:m,type:"video"}),h=!1,this.mp4Durations[_]=b,this.mp4Durations.keys.push(_)),p&&this.emit(u.EVENTS.RANDOM_ACCESS_POINT,_)}if(this.mp4Durations.keys.length>1e4){var S=this.mp4Durations;this.mp4Durations={},this.mp4Durations.keys=S.keys.slice(-100),this.mp4Durations.keys.forEach((function(e){t.mp4Durations[e]=S[e]}))}o.length&&a.Z.log(this.TAG,"remux to mp4 video:",[n/1e3,o[o.length-1].dts/1e3]);var k=new d;if(o.length&&i.meta){var A=v.moof({id:i.meta.id,time:n,samples:o}),T=v.mdat(l);k.write(A,T),this.segmentRemuxed("video",k,o[o.length-1].pts-o[0].pts)}if(s&&(this.segmentRemuxed("video",s),r.length))return i.samples=r,this.remuxVideo(i);this.isFirstVideo=!1,this.emit(u.EVENTS.TRACK_REMUXED,"video",k),i.samples=[],i.length=0}}}},{key:"remuxAudio",value:function(e){var t=(e||{}).samples,i=-1,r=[],n=null,s={samples:[]};if(t&&t.length){for(var o=1e4,l=!1;t.length&&o-- >0;){var c=t.shift(),h=c.data,f=c.options;if(!this.isFirstAudio&&f&&f.meta){n=this.remuxInitSegment("audio",f.meta),f.meta=null,t.unshift(c),f.isContinue||(this._audioDtsBase=0);break}var p=Math.max(0,c.dts-this.audioDtsBase),y=c.originDts;l||(i=p,l=!0);var m;m=c.duration?c.duration:this._audioMeta.refSampleDurationFixed?this._audioMeta.refSampleDurationFixed:t.length>=1?t[0].dts-this.audioDtsBase-p:r.length>=1?r[r.length-1].duration:this._audioMeta.refSampleDuration,a.Z.long&&a.Z.log(this.TAG,"audio dts ".concat(p),"pts ".concat(p),"originDts ".concat(y),"duration ".concat(m)),this.audioAllDuration+=m;var g={dts:p,pts:p,cts:0,size:h.byteLength,duration:c.duration?c.duration:m,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,isNonSync:0},isKeyframe:!0,originDts:y,type:"audio"},_={buffer:[],size:0};m>=0&&(_.buffer.push(h),_.size+=h.byteLength,s.samples.push(_),r.push(g))}var b=new d;if(r.length&&e.meta){a.Z.log(this.TAG,"remux to mp4 audio:",[i/1e3,r[r.length-1].dts/1e3]);var E=v.moof({id:e.meta.id,time:i,samples:r}),S=v.mdat(s);b.write(E,S),this.segmentRemuxed("audio",b,r[r.length-1].dts-r[0].dts)}if(n&&(this.segmentRemuxed("audio",n),t.length))return e.samples=t,this.remuxAudio(e);this.isFirstAudio=!1,this.emit(u.EVENTS.TRACK_REMUXED,"audio",b),e.samples=[],e.length=0}}},{key:"segmentRemuxed",value:function(e,t,i){this.emit(u.EVENTS.MEDIA_SEGMENT,e,t,i)}},{key:"videoDtsBase",get:function(){return null!==this._videoDtsBase?this._videoDtsBase:this._dtsBase},set:function(e){this._videoDtsBase=e}},{key:"audioDtsBase",get:function(){return null!==this._audioDtsBase?this._audioDtsBase:this._dtsBase}}])&&m(t.prototype,i),r&&m(t,r),u}(s());function E(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var S=r.Z.REMUX_EVENTS,k=r.Z.PLAYER_EVENTS,A=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="Mp4Remuxer",this._curTime=t,this.remuxer||this.initRemuxer()}var t,i;return t=e,(i=[{key:"init",value:function(){this.on(S.REMUX_MEDIA,this.remux.bind(this)),this.on(S.REMUX_METADATA,this.onMetaDataReady.bind(this)),this.on(S.DETECT_CHANGE_STREAM,this.resetDtsBase.bind(this)),this.on(S.DETECT_FRAG_ID_DISCONTINUE,this.seek.bind(this)),this.on(k.SEEK,this.seek.bind(this))}},{key:"initRemuxer",value:function(){this.remuxer=new b({audioMeta:null,videoMeta:null,curTime:this._curTime}),this.remuxer.on(b.EVENTS.MEDIA_SEGMENT,this.writeToSource.bind(this)),this.remuxer.on(b.EVENTS.TRACK_REMUXED,this.onTrackRemuxed.bind(this))}},{key:"remux",value:function(){if(this.remuxer)try{this.remuxer._videoMeta||(this.remuxer._videoMeta=this.videoMeta,this.remuxer._audioMeta=this.audioMeta);var e=this._context.getInstance("TRACKS"),t=e.audioTrack,i=e.videoTrack;this.remuxer.remux(t,i)}catch(e){this.emit(S.REMUX_ERROR,this.TAG,e)}}},{key:"resetDtsBase",value:function(){this.remuxer&&this.remuxer.resetDtsBase()}},{key:"seek",value:function(e){this.remuxer&&this.remuxer.seek(e)}},{key:"onMetaDataReady",value:function(e,t){var i;this.remuxer||this.initRemuxer(),i="audio"===e?this._context.getInstance("TRACKS").audioTrack:this._context.getInstance("TRACKS").videoTrack;var r=this._context.getInstance("PRE_SOURCE_BUFFER"),a=r.getSource(e);a||(a=r.createSource(e)),a.mimetype=i.meta.codec,a.init=this.remuxer.remuxInitSegment(e,i.meta),t&&this.writeToSource(e,a.init,0),this.emit(S.INIT_SEGMENT,e)}},{key:"onTrackRemuxed",value:function(e){this.emit(S.MEDIA_SEGMENT,e)}},{key:"writeToSource",value:function(e,t,i){var r=this._context.getInstance("PRE_SOURCE_BUFFER"),a=r.getSource(e);a||(a=r.createSource(e)),a.data.push(t),i&&(a.bufferDuration=i+(a.bufferDuration||0))}},{key:"videoMeta",get:function(){return this._context.getInstance("TRACKS").videoTrack.meta}},{key:"audioMeta",get:function(){return this._context.getInstance("TRACKS").audioTrack.meta}},{key:"destroy",value:function(){this.remuxer&&this.remuxer.destroy(),this.remuxer=null}}])&&E(t.prototype,i),e}()},33971:(e,t,i)=>{function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}i.d(t,{Z:()=>n});const n=new(function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);try{var i=/xgd=(\d)/.exec(document.cookie);this._status=!!i,this._level=i&&i[1]}catch(e){this._status=!1}["group","groupEnd","log","warn","error","trace"].forEach((function(e){t[e]=function(i,a,n,s,o,u,l,d,c,h){var f,p;if(t._status){var v=i,y=[a,n,s,o,u,l,d,c,h].filter((function(e){return void 0!==e}));(f=console)[e].apply(f,["["+v+"]:"].concat(function(e){if(Array.isArray(e))return r(e)}(p=y)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(p)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?r(e,t):void 0}}(p)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()))}}}))}var t,i;return t=e,(i=[{key:"enable",get:function(){return this._status}},{key:"long",get:function(){return"2"===this._level}}])&&a(t.prototype,i),e}())},32139:(e,t,i)=>{function r(){var e,t=!1,i=!1;try{var r=new(window.AudioContext||window.webkitAudioContext);r.close(),r=null,t=!0}catch(e){}try{for(var a=document.createElement("canvas"),n=["webgl","experimental-webgl","moz-webgl","webkit-3d"],s=0;s<n.length;s++){var o=a.getContext(n[s]);if(o){o=null,a=null,i=!0;break}}}catch(e){}if("customElements"in window&&window.customElements.define){var u=window.customElements.get("live-video");e=u&&u.isSupported()}return t&&i&&e}i.d(t,{Z:()=>r})},43671:(e,t,i)=>{i.d(t,{Z:()=>m});var r=i(91780);function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var n=function(e){for(var t in e)if(e.hasOwnProperty(t)&&null===e[t])return!1;return!0},s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mimeType=null,this.duration=null,this.hasVideo=!1,this.video={codec:null,width:null,height:null,profile:null,level:null,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},chromaFormat:null,parRatio:{width:1,height:1}},this.hasAudio=!1,this.audio={codec:null,sampleRate:null,sampleRateIndex:null,channelCount:null}}var t,i,r;return t=e,r=[{key:"isBaseInfoReady",value:function(e){return n(e)}},{key:"isVideoReady",value:function(e){return!e.hasVideo||n(e.video)}},{key:"isAudioReady",value:function(e){return!e.hasAudio||n(e.video)}}],(i=[{key:"isComplete",value:function(){return e.isBaseInfoReady(this)&&e.isVideoReady(this)&&e.isAudioReady(this)}}])&&a(t.prototype,i),r&&a(t,r),e}(),o=i(76154),u=i.n(o);function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function d(e,t,i){return d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(i):a.value}},d(e,t,i||e)}function c(e,t){return c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c(e,t)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t,i){return t&&p(e.prototype,t),i&&p(e,i),e}var y="__TO__";const m=function(){function e(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];f(this,e),this._emitter=new(u()),this._emitter.off||(this._emitter.off=this._emitter.removeListener),this.mediaInfo=new s,this._instanceMap={},this._clsMap={},this._inited=!1,this.allowedEvents=r,this._configs=i,this._player=t,this._hooks={}}return v(e,[{key:"getInstance",value:function(e){return this._instanceMap[e]||null}},{key:"initInstance",value:function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];var a=i[0],n=i[1],s=i[2],o=i[3];if(this._clsMap[e]){var u=new this._clsMap[e](a,n,s,o);return this._instanceMap[e]=u,u.init&&u.init(),u}throw new Error("".concat(e,"未在context中注册"))}},{key:"init",value:function(e){if(!this._inited){for(var t in this._clsMap)this._clsMap.hasOwnProperty(t)&&!this._instanceMap[t]&&this.initInstance(t,e);this._inited=!0}}},{key:"registry",value:function(e,t){var i=this,r=this._emitter,a=this._isMessageNameValid.bind(this),n=this,s=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(u,t);var i,s,o=(i=u,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=h(i);if(s){var r=h(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function u(t,i,r){var a;return f(this,u),(a=o.call(this,t,i,r)).listeners={},a.onceListeners={},a.TAG=e,a._context=n,a}return v(u,[{key:"on",value:function(t,i){return a(t),this.listeners[t]?this.listeners[t].push(i):this.listeners[t]=[i],r.on("".concat(t).concat(y).concat(e),i),r.on(t,i)}},{key:"before",value:function(e,t){a(e),n._hooks[e]?n._hooks[e].push(t):n._hooks[e]=[t]}},{key:"once",value:function(t,i){return a(t),this.onceListeners[t]?this.onceListeners[t].push(i):this.onceListeners[t]=[i],r.once("".concat(t).concat(y).concat(e),i),r.once(t,i)}},{key:"emit",value:function(e){a(e);for(var t=n._hooks?n._hooks[e]:null,i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];if(t)for(var u=0,l=t.length;u<l;u++)t[u].apply(void 0,s);return r.emit.apply(r,[e].concat(s))}},{key:"emitTo",value:function(e,t){a(t);for(var i=arguments.length,n=new Array(i>2?i-2:0),s=2;s<i;s++)n[s-2]=arguments[s];return r.emit.apply(r,["".concat(t).concat(y).concat(e)].concat(n))}},{key:"off",value:function(e,t){return a(e),r.off(e,t)}},{key:"removeListeners",value:function(){var t=Object.prototype.hasOwnProperty.bind(this.listeners);for(var i in this.listeners)if(t(i))for(var a=this.listeners[i]||[],n=0;n<a.length;n++){var s=a[n];r.off(i,s),r.off("".concat(i).concat(y).concat(e),s)}for(var o in this.onceListeners)if(t(o))for(var u=this.onceListeners[o]||[],l=0;l<u.length;l++){var d=u[l];r.off(o,d),r.off("".concat(o).concat(y).concat(e),d)}}},{key:"destroy",value:function(){if(this.removeListeners(),this.listeners={},delete n._instanceMap[e],d(h(u.prototype),"destroy",this))return d(h(u.prototype),"destroy",this).call(this);this._context=null}},{key:"_player",get:function(){return this._context?this._context._player:null},set:function(e){this._context&&(this._context._player=e)}},{key:"_pluginConfig",get:function(){return this._context?this._context._configs:null}}]),u}(t);return this._clsMap[e]=s,function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i.initInstance.apply(i,[e].concat(r))}}},{key:"seek",value:function(e){this._emitter.emit(r.Z.PLAYER_EVENTS.SEEK,e)}},{key:"destroyInstances",value:function(){var e=this;Object.keys(this._instanceMap).forEach((function(t){e._instanceMap[t].destroy&&e._instanceMap[t].destroy()}))}},{key:"destroy",value:function(){this.destroyInstances(),this._emitter&&this._emitter.removeAllListeners(),this._emitter=null,this.allowedEvents=[],this._clsMap=null,this._hooks=null,this._player=null,this._configs=null}},{key:"_isMessageNameValid",value:function(e){if(this.allowedEvents&&this.allowedEvents.length&&!this.allowedEvents.indexOf(e)<0)throw new Error("unregistered message name: ".concat(e))}}]),e}()},75682:(e,t,i)=>{function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}i.d(t,{Z:()=>n});var a=i(91780).Z.CRYPTO_EVENTS;const n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.inputBuffer=t.inputbuffer,this.outputBuffer=t.outputbuffer,this.key=t.key,this.iv=t.iv,this.method=t.method,this.crypto=window.crypto||window.msCrypto}var t,i;return t=e,(i=[{key:"init",value:function(){this.on(a.START_DECRYPTO,this.decrypto.bind(this))}},{key:"decrypto",value:function(){var e=this;this.aeskey?this.decryptoData():this.crypto.subtle.importKey("raw",this.key.buffer,{name:"AES-CBC"},!1,["encrypt","decrypt"]).then((function(t){e.aeskey=t,e.decryptoData()}))}},{key:"decryptoData",value:function(){var e=this,t=this._context.getInstance(this.inputBuffer),i=this._context.getInstance(this.outputBuffer),r=t.shift();r&&this.crypto.subtle.decrypt({name:"AES-CBC",iv:this.iv.buffer},this.aeskey,r).then((function(t){i.push(new Uint8Array(t)),e.emit(a.DECRYPTED),e.decryptoData(r)}))}}])&&r(t.prototype,i),e}()},91780:(e,t,i)=>{i.d(t,{Z:()=>v});var r={VISIBILITY_CHANGE:"VISIBILITY_CHANGE"},a={SEEK:"SEEK"},n={LADER_START:"LOADER_START",LOADER_DATALOADED:"LOADER_DATALOADED",LOADER_COMPLETE:"LOADER_COMPLETE",LOADER_RESPONSE_HEADERS:"LOADER_RESPONSE_HEADERS",LOADER_ERROR:"LOADER_ERROR",LOADER_RETRY:"LOADER_RETRY",LOADER_TTFB:"LOADER_TTFB"},s={DEMUX_START:"DEMUX_START",DEMUX_COMPLETE:"DEMUX_COMPLETE",DEMUX_ERROR:"DEMUX_ERROR",METADATA_PARSED:"METADATA_PARSED",SEI_PARSED:"SEI_PARSED",VIDEO_METADATA_CHANGE:"VIDEO_METADATA_CHANGE",AUDIO_METADATA_CHANGE:"AUDIO_METADATA_CHANGE",MEDIA_INFO:"MEDIA_INFO",ISKEYFRAME:"ISKEYFRAME"},o={REMUX_METADATA:"REMUX_METADATA",REMUX_MEDIA:"REMUX_MEDIA",MEDIA_SEGMENT:"MEDIA_SEGMENT",REMUX_ERROR:"REMUX_ERROR",INIT_SEGMENT:"INIT_SEGMENT",DETECT_CHANGE_STREAM:"DETECT_CHANGE_STREAM",DETECT_CHANGE_STREAM_DISCONTINUE:"DETECT_CHANGE_STREAM_DISCONTINUE",DETECT_AUDIO_GAP:"DETECT_AUDIO_GAP",DETECT_LARGE_GAP:"DETECT_LARGE_GAP",DETECT_AUDIO_OVERLAP:"DETECT_AUDIO_OVERLAP",RANDOM_ACCESS_POINT:"RANDOM_ACCESS_POINT",DETECT_FRAG_ID_DISCONTINUE:"DETECT_FRAG_ID_DISCONTINUE"},u={SOURCE_UPDATE_END:"SOURCE_UPDATE_END",MSE_ERROR:"MSE_ERROR",MSE_WRONG_TRACK_ADD:"MSE_WRONG_TRACK_ADD",MSE_CHANGE_CODEC_ERROR:"MSE_CHANGE_CODEC_ERROR"},l={RETRY_TIME_EXCEEDED:"RETRY_TIME_EXCEEDED"},d=Object.assign({},n,s,o,u,l,a,r),c=[],h=[];for(var f in d)d.hasOwnProperty(f)&&c.push(d[f]);for(var p in d)d.hasOwnProperty(p)&&h.push(d[p]);const v={ALLEVENTS:d,HLS_EVENTS:l,REMUX_EVENTS:o,DEMUX_EVENTS:s,MSE_EVENTS:u,LOADER_EVENTS:n,FlvAllowedEvents:c,HlsAllowedEvents:h,CRYPTO_EVENTS:{START_DECRYPTOO:"START_DECRYPTO",DECRYPTED:"DECRYPTED"},PLAYER_EVENTS:a,BROWSER_EVENTS:r}},26115:(e,t,i)=>{i.d(t,{Z:()=>d});var r=i(91780);function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n(this,"_sampleQueue",[]),n(this,"_speed",0),n(this,"_recentSpeed",0),n(this,"_timer",0),n(this,"_dit",0),n(this,"_contentLength",0),n(this,"_totalByteSize",0),n(this,"_speedDown",!1)}var t,i;return t=e,(i=[{key:"recordLoading",value:function(e){var t=e.get("content-length")||0,i=e.get("Accept-Ranges"),r=e.get("Content-Range");if(t&&!i&&!r){this._contentLength=t;var a=Math.floor(t/this._speed*1e3);a<50||(this._dit=performance.now(),this._startTick(t,a))}}},{key:"recordLoaded",value:function(){this._cleanTimer();var e=performance.now()-this._dit;this._addSample(Math.floor(this._contentLength/e))}},{key:"recordChunk",value:function(e){if(!this._timer)return this._dit=performance.now(),void this._startTickForStream();this._totalByteSize+=e,this._contentLength+=e}},{key:"_startTick",value:function(e,t){var i=this;this._cleanTimer(),this._timer=setInterval((function(){var t=performance.now()-i._dit;i._addSample(Math.floor(e/t))}),t)}},{key:"_startTickForStream",value:function(){var e=this;this._timer=setInterval((function(){e._addSample(e._calcSampleSpeed())}),1e3)}},{key:"_calcSampleSpeed",value:function(){var e=performance.now()-this._dit,t=Math.floor(this._contentLength/e);return this._contentLength=0,this._dit=performance.now(),t}},{key:"_addSample",value:function(e){this._recentSpeed=1e3*e,this._sampleQueue.length>3&&(this._sampleQueue=[]),this._sampleQueue.push(e),this._calcAvgSpeed(this._sampleQueue)}},{key:"_calcAvgSpeed",value:function(e){var t=e.length,i=e.reduce((function(e,t){return e+t}),0)/t;this._speed=1e3*Math.floor(i)}},{key:"_cleanTimer",value:function(){clearTimeout(this._timer),this._timer=0}},{key:"clean",value:function(){this._cleanTimer()}},{key:"destroy",value:function(){clearTimeout(this._timer)}},{key:"totalByteSize",get:function(){return this._totalByteSize}},{key:"avgSpeed",get:function(){return this._speed||this._addSample(this._calcSampleSpeed()),8*this._speed}},{key:"recentSpeed",get:function(){return this._recentSpeed||this._addSample(this._calcSampleSpeed()),8*this._recentSpeed}}])&&a(t.prototype,i),e}();function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function u(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=r.Z.LOADER_EVENTS;const d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.configs=Object.assign({},t),this.url=null,this.status=0,this.error=null,this._reader=null,this._canceled=!1,this._destroyed=!1,this.readtype=this.configs.readtype,this.buffer=this.configs.buffer||"LOADER_BUFFER",this._loaderTaskNo=0,this._ttfbInfo=null,this._responseHeader=null,this._speed=new s,window.AbortController&&(this.abortControllerEnabled=!0)}var t,i,r;return t=e,i=[{key:"init",value:function(){this.on(l.LADER_START,this.load.bind(this))}},{key:"fetch",value:function(e){function t(t,i,r){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t,i){var r=this,a=null;this.abortControllerEnabled&&(this.abortController=new window.AbortController),Object.assign(t,{signal:this.abortController?this.abortController.signal:void 0});var n=(new Date).getTime();return Promise.race([fetch(e,t),new Promise((function(e,t){a=setTimeout((function(){t({code:999,message:"fetch timeout"}),r.abortController&&r.abortController.abort()}),i||1e4)}))]).then((function(t){var i;a&&(clearTimeout(a),a=null),null===(i=r._speed)||void 0===i||i.recordLoading(t.headers);var s=(new Date).getTime();return r._ttfbInfo={url:e,responseUrl:t.url,start:n,end:s,elapsed:s-n,ok:t.ok},r.emit(l.LOADER_TTFB,r._ttfbInfo),t}))}))},{key:"internalLoad",value:function(e,t,i,r){var a=this,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;if(!this._destroyed)return this.loading=!0,this.fetch(this.url,t,s).then((function(u){if(!a._destroyed&&a.emit(l.LOADER_RESPONSE_HEADERS,a.TAG,u.headers),a._responseHeader=u.headers,u.ok)return a.status=u.status,Promise.resolve().then((function(){a._onFetchResponse(u,o)})),Promise.resolve(u);i-- >0?a._retryTimer=setTimeout((function(){return a.emit(l.LOADER_RETRY,a.TAG,{response:u,reason:"response not ok",retryTime:r-i}),a.internalLoad(e,t,i,r,n,s,o)}),n):(a.loading=!1,a.emit(l.LOADER_ERROR,a.TAG,{code:u.status||21,message:"".concat(u.status," (").concat(u.statusText,")")}))})).catch((function(u){if(a._destroyed||u&&"AbortError"===u.name)a.loading=!1;else if(i-- >0)a._retryTimer=setTimeout((function(){return a.emit(l.LOADER_RETRY,a.TAG,{error:u,reason:"fetch error",retryTime:r-i}),a.internalLoad(e,t,i,r,n,s,o)}),n);else{if(a.loading=!1,u&&"AbortError"===u.name)return;a.emit(l.LOADER_ERROR,a.TAG,Object.assign({code:21},u))}}))}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.retryCount,a=i.retryDelay,n=i.loadTimeout,s=i.maxReaderInterval;if(e){r=void 0===r?3:r,this.url=e,this._canceled=!1;var o=this.getParams(t);return this.internalLoad(e,o,r,r,a,n,s)}this.emit(l.LOADER_ERROR,this.TAG,{code:0,message:"empty url"})}},{key:"_onFetchResponse",value:function(e,t){var i=this,r=this,a=this._context.getInstance(this.buffer);this._loaderTaskNo++;var n=this._loaderTaskNo;if(!0===e.ok){var s;switch(this.readtype){case 2:s=e.json();break;case 1:s=e.text();break;case 3:s=e.arrayBuffer();break;default:return this._onReader(e.body.getReader(),n,t)}if(!s)return;s.then((function(e){var t;null===(t=i._speed)||void 0===t||t.recordLoaded(),r.loading=!1,r._canceled||r._destroyed||(a?(a.push(e instanceof ArrayBuffer?new Uint8Array(e):e),r.emit(l.LOADER_COMPLETE,a)):r.emit(l.LOADER_COMPLETE,e))})).catch((function(){}))}}},{key:"_onReader",value:function(e,t,i){var r=this,a=this._context.getInstance(this.buffer);if(!a&&this._reader||this._destroyed)try{this._reader.cancel()}catch(e){}this._reader=e,!1!==this.loading&&(this._noDataTimer=setTimeout((function(){!1!==r.loading&&r.emit(l.LOADER_COMPLETE,"nobuffer")}),i||3e3),this._reader&&this._reader.read().then((function(n){var s,o;if(clearTimeout(r._noDataTimer),!r._canceled&&!r._destroyed)return n.done?(r.loading=!1,r.status=0,null===(o=r._speed)||void 0===o||o.destroy(),void Promise.resolve().then((function(){r.emit(l.LOADER_COMPLETE,"done")}))):(a.push(n.value),null===(s=r._speed)||void 0===s||s.recordChunk(n.value.byteLength),Promise.resolve().then((function(){r.emit(l.LOADER_DATALOADED,a)})),r._onReader(e,t,i));if(r._reader)try{r._reader.cancel()}catch(e){}})).catch((function(e){clearTimeout(r._noDataTimer),r.loading=!1,(!e||"AbortError"!==e.name&&"network error"!==e.message)&&r.emit(l.LOADER_ERROR,r.TAG,e)})))}},{key:"getParams",value:function(e){var t=Object.assign({},e),i=new Headers,r={method:"GET",headers:i,mode:"cors",cache:"default"};if("object"===o(this.configs.headers)){var a=this.configs.headers;for(var n in a)a.hasOwnProperty(n)&&i.append(n,a[n])}if("object"===o(t.headers)){var s=t.headers;for(var u in s)s.hasOwnProperty(u)&&i.append(u,s[u])}return!1===t.cors&&(r.mode="same-origin"),t.withCredentials&&(r.credentials="include"),r}},{key:"ttfbInfo",get:function(){return this._ttfbInfo}},{key:"avgSpeed",get:function(){var e;return(null===(e=this._speed)||void 0===e?void 0:e.avgSpeed)||0}},{key:"recentSpeed",get:function(){var e;return(null===(e=this._speed)||void 0===e?void 0:e.recentSpeed)||0}},{key:"currentSpeed",get:function(){var e;return(null===(e=this._speed)||void 0===e?void 0:e.avgSpeed)/8e3}},{key:"totalByteSize",get:function(){var e;return null===(e=this._speed)||void 0===e?void 0:e.totalByteSize}},{key:"responseHeader",get:function(){return this._responseHeader}},{key:"cancel",value:function(){var e;if(this._reader){try{var t=this._reader.cancel();t.catch&&t.catch((function(e){}))}catch(e){}this._reader=null,this.loading=!1}clearTimeout(this._noDataTimer),this._canceled=!0,this.abortController&&this.abortController.abort(),null===(e=this._speed)||void 0===e||e.clean()}},{key:"destroy",value:function(){var e;this._destroyed=!0,this._responseHeader=null,clearTimeout(this._retryTimer),clearTimeout(this._noDataTimer),this.cancel(),null===(e=this._speed)||void 0===e||e.destroy(),this._speed=null}}],r=[{key:"isSupported",value:function(){return!!window.fetch}},{key:"type",get:function(){return"loader"}}],i&&u(t.prototype,i),r&&u(t,r),e}()},19960:(e,t,i)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}i.d(t,{Z:()=>s});var n=i(91780).Z.LOADER_EVENTS;const s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._xhr=null,this.configs=Object.assign({},t),this.loading=!1,this._readtype=this.configs.readtype,this._bufferType=this.configs.buffer||"LOADER_BUFFER",this._requestInfo=null,this._onReadyStateChange=this._onReadyStateChange.bind(this),this._onError=this._onError.bind(this),this._onAbort=this._onAbort.bind(this),this._onTimeout=this._onTimeout.bind(this)}var t,i,s;return t=e,i=[{key:"bufferIns",get:function(){return this._context.getInstance(this._bufferType)}},{key:"init",value:function(){this.on(n.LADER_START,this.load.bind(this))}},{key:"_createXhr",value:function(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=Object.assign({},t);this._requestInfo={url:e,options:a,retryTimes:i,totalRetry:i,delayTime:r},this._xhr=this._createXhr(),this.loading=!0;try{this._bindEvents(),this._loadInternal(e,a)}catch(e){this._whenError({code:this._xhr.status,message:e&&e.message})}}},{key:"_loadInternal",value:function(e,t){var i=this._xhr;i.open("GET",e,!0),this._setTimeout(i,t),this._setCredentails(i,t),this._setHeaders(i,t),this._setResponseType(i),i.send()}},{key:"_bindEvents",value:function(){var e=this._xhr;e.addEventListener("readystatechange",this._onReadyStateChange),e.addEventListener("timeout",this._onTimeout),e.addEventListener("error",this._onError),e.addEventListener("abort",this._onAbort)}},{key:"_setTimeout",value:function(e,t){e.timeout=t.timeout||2e3}},{key:"_setCredentails",value:function(e,t){t.withCredentials&&(e.withCredentials=!0)}},{key:"_setHeaders",value:function(e,t){if("object"===r(t.headers)){var i=t.headers;for(var a in i)i.hasOwnProperty(a)&&e.setRequestHeader(a,i[a])}}},{key:"_setResponseType",value:function(e){switch(this._readtype){case 3:e.responseType="arraybuffer";break;case 2:e.responseType="json";break;default:e.responseType=""}}},{key:"_onReadyStateChange",value:function(){var e=this._xhr,t=e.readyState,i=e.status;if(4===t){if(i>=200&&i<300)return void this._onComplete(this._xhr);if(0===i)return;this._onError()}}},{key:"_onComplete",value:function(e){var t;switch(this._readtype){case 2:try{t=JSON.parse(e.responseText)}catch(e){}break;case 3:var i=e.response;t=new Uint8Array(i);break;default:t=e.responseText}this.bufferIns?(this.bufferIns.push(t),this.emit(n.LOADER_COMPLETE,this.bufferIns)):this.emit(n.LOADER_COMPLETE,t),this.loading=!1}},{key:"_onError",value:function(){var e=this._xhr,t={code:e.status||21,message:e.statusText};this._whenError(t)}},{key:"_onTimeout",value:function(){console.warn("timeout"),this._whenError({code:999,message:"fetch timeout"})}},{key:"_onAbort",value:function(){console.warn("abort")}},{key:"_whenError",value:function(e){var t=this,i=this._requestInfo,r=i.url,a=i.options,s=i.totalRetry,o=i.retryTimes,u=i.delayTime;if(!o)return this.loading=!1,void this.emit(n.LOADER_ERROR,this.TAG,e);o--,setTimeout((function(){t.emit(n.LOADER_RETRY,t.TAG,{response:e,reason:"response not ok",retryTime:s-o}),t.load(r,a,o,u)}),u)}},{key:"cancel",value:function(){4!==this._xhr.readyState&&this._xhr.abort()}},{key:"destroy",value:function(){this.cancel(),this._xhr&&(this._xhr.removeEventListener("readystatechange",this._onReadyStateChange),this._xhr.removeEventListener("timeout",this._onTimeout),this._xhr.removeEventListener("error",this._onError),this._xhr.removeEventListener("abort",this._onAbort),this._xhr=null)}}],s=[{key:"type",get:function(){return"loader"}}],i&&a(t.prototype,i),s&&a(t,s),e}()},94650:(e,t,i)=>{i.d(t,{Z:()=>o});var r=i(91780),a=i(33971);function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=r.Z.MSE_EVENTS;const o=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i&&(this._context=i,this.emit=i._emitter.emit.bind(i._emitter)),this.TAG="MSE",this.configs=Object.assign({},t),this.container=this.configs.container,this.format=this.configs.format,this.mediaSource=null,this.sourceBuffers={},this.preloadTime=this.configs.preloadTime||1,this.onSourceOpen=this.onSourceOpen.bind(this),this.onTimeUpdate=this.onTimeUpdate.bind(this),this.onUpdateEnd=this.onUpdateEnd.bind(this),this.onWaiting=this.onWaiting.bind(this),this.opened=!1,this.videoCodec=""}var t,i,r;return t=e,i=[{key:"init",value:function(){this.mediaSource=new self.MediaSource,this.mediaSource.addEventListener("sourceopen",this.onSourceOpen),this._url=null,this.container.addEventListener("timeupdate",this.onTimeUpdate),this.container.addEventListener("waiting",this.onWaiting)}},{key:"resetContext",value:function(t,i){if(this._context=t,this.emit=t._emitter.emit.bind(t._emitter),!i)for(var r=0;r<Object.keys(this.sourceBuffers).length;r++){var a=this.sourceBuffers[Object.keys(this.sourceBuffers)[r]];a.updating||e.clearBuffer(a)}}},{key:"onTimeUpdate",value:function(){this.emit("TIME_UPDATE",this.container)}},{key:"onWaiting",value:function(){this.emit("WAITING",this.container)}},{key:"onSourceOpen",value:function(){this.opened=!0,this.addSourceBuffers()}},{key:"onUpdateEnd",value:function(){this.emit(s.SOURCE_UPDATE_END),this.doAppend()}},{key:"addSourceBuffers",value:function(){if(this.mediaSource&&"open"===this.mediaSource.readyState&&this.opened){var e,t=this._context.getInstance("PRE_SOURCE_BUFFER"),i=this._context.getInstance("TRACKS");if(t&&i){t=t.sources;for(var r=!1,n=0,o=Object.keys(t).length;n<o;n++){var u=Object.keys(t)[n];r=!1,"audio"===u?e=i.audioTrack:"video"===u&&(e=i.videoTrack),e&&null!==t[u].init&&t[u].data.length&&(r=!0)}if(r){if(Object.keys(this.sourceBuffers).length>1)return;for(var l=0,d=Object.keys(t).length;l<d;l++){var c=Object.keys(t)[l];if(!this.sourceBuffers[c]){var h=t[c],f="video"===c?"video/mp4;codecs="+h.mimetype:"audio/mp4;codecs="+h.mimetype;try{a.Z.log(this.TAG,"add sourcebuffer",f);var p=this.mediaSource.addSourceBuffer(f);this.sourceBuffers[c]=p,p.addEventListener("updateend",this.onUpdateEnd),"video"===c&&(this.videoCodec=h.mimetype)}catch(e){if(22===e.code&&Object.keys(this.sourceBuffers).length>0)return this.emit(s.MSE_WRONG_TRACK_ADD,c);this.emit(s.MSE_ERROR,this.TAG,new Error(e.message))}}}Object.keys(this.sourceBuffers).length===this.sourceBufferLen&&this.doAppend()}}}}},{key:"doAppend",value:function(){if(this.mediaSource&&"closed"!==this.mediaSource.readyState){try{this._doCleanupSourceBuffer()}catch(e){}var e=this._context.getInstance("PRE_SOURCE_BUFFER");if(e&&!(Object.keys(this.sourceBuffers).length<this.sourceBufferLen))for(var t=0;t<Object.keys(this.sourceBuffers).length;t++){var i=Object.keys(this.sourceBuffers)[t],r=this.sourceBuffers[i];if(!r.updating){var a=e.sources[i];if(this["no".concat(i)])a.data=[],a.init.buffer=null;else if(a&&!a.inited)try{r.appendBuffer(a.init.buffer.buffer),a.inited=!0}catch(e){}else if(a){var n=a.data.shift();if(n)try{r.appendBuffer(n.buffer.buffer)}catch(e){a.data.unshift(n)}}}}}}},{key:"changeVideoCodecType",value:function(e){var t=this.sourceBuffers.video;if(null!=t&&t.updating)throw new Error("source buffer in updating");t.changeType("video/mp4;codecs=".concat(e)),this.videoCodec=e}},{key:"endOfStream",value:function(){try{var e;"open"===this.mediaSource.readyState&&null!==(e=this.container)&&void 0!==e&&e.readyState&&this.mediaSource.endOfStream()}catch(e){}}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{for(var i=0;i<Object.keys(this.sourceBuffers).length;i++){var r=this.sourceBuffers[Object.keys(this.sourceBuffers)[i]];r.updating||e>t&&r.remove(t,e)}}catch(e){}}},{key:"_doCleanupSourceBuffer",value:function(){for(var e=this.container.currentTime,t={video:[],audio:[]},i=0;i<Object.keys(this.sourceBuffers).length;i++){for(var r=Object.keys(this.sourceBuffers)[i],a=this.sourceBuffers[r],n=a.buffered,s=!1,o=0;o<n.length;o++){var u=n.start(o),l=n.end(o);if(u<=e&&e<l+3){if(e-u>=180){s=!0;var d=e-180;t[r].push({start:u,end:d})}}else l<e&&e-u>=180&&(s=!0,t[r].push({start:u,end:l}))}s&&!a.updating&&this._doRemoveRanges(t)}}},{key:"_doRemoveRanges",value:function(e){for(var t in e)if(this.sourceBuffers[t]&&!this.sourceBuffers[t].updating)for(var i=this.sourceBuffers[t],r=e[t];r.length&&!i.updating;){var a=r.shift();try{a&&a.end>a.start&&i.remove(a.start,a.end)}catch(e){}}}},{key:"cleanBuffers",value:function(){for(var t=this,i=[],r=function(r){var a,n=t.sourceBuffers[Object.keys(t.sourceBuffers)[r]];a=n.updating?new Promise((function(t){n.addEventListener("updateend",(function i(){var r=3;setTimeout((function i(){n.updating?r>0?(setTimeout(i,200),r--):t():(e.clearBuffer(n),n.addEventListener("updateend",(function(){t()})))}),200),n.removeEventListener("updateend",i)}))})):new Promise((function(t){n.buffered.length?(e.clearBuffer(n),n.addEventListener("updateend",(function(){t()}))):t()})).catch((function(){})),i.push(a)},a=0;a<Object.keys(this.sourceBuffers).length;a++)r(a);return Promise.all(i)}},{key:"removeBuffers",value:function(){for(var t=this,i=[],r=function(r){var a=t.sourceBuffers[Object.keys(t.sourceBuffers)[r]];a.removeEventListener("updateend",t.onUpdateEnd);var n;n=a.updating?new Promise((function(t){a.addEventListener("updateend",(function i(){var r=3;setTimeout((function i(){a.updating?r>0?(setTimeout(i,200),r--):t():(e.clearBuffer(a),a.addEventListener("updateend",(function(){t()})))}),200),a.removeEventListener("updateend",i)}))})):new Promise((function(t){a.buffered.length?(e.clearBuffer(a),a.addEventListener("updateend",(function(){t()}))):t()})).catch((function(){})),i.push(n)},a=0;a<Object.keys(this.sourceBuffers).length;a++)r(a);return Promise.all(i)}},{key:"destroy",value:function(){var e=this;return this.container?(this.container.removeEventListener("timeupdate",this.onTimeUpdate),this.container.removeEventListener("waiting",this.onWaiting),this.mediaSource.removeEventListener("sourceopen",this.onSourceOpen),this.removeBuffers().then((function(){for(var t=Object.keys(e.sourceBuffers),i=0;i<t.length;i++){var r=e.sourceBuffers[t[i]];delete e.sourceBuffers[t[i]],"open"===e.mediaSource.readyState&&e.mediaSource.removeSourceBuffer(r)}e.endOfStream();try{window.URL.revokeObjectURL(e.url)}catch(e){}e.url=null,e.configs={},e.container=null,e.mediaSource=null,e.sourceBuffers={},e.preloadTime=1,e.onSourceOpen=null,e.onTimeUpdate=null,e.onUpdateEnd=null,e.onWaiting=null,e.noaudio=void 0,e.novideo=void 0}))):Promise.resolve()}},{key:"sourceBufferLen",get:function(){return this._context.mediaInfo?(!!this._context.mediaInfo.hasVideo&&!this.novideo)+(!!this._context.mediaInfo.hasAudio&&!this.noaudio):this.noaudio||this.novideo?1:2}},{key:"url",get:function(){if(!this._url)try{this._url=window.URL.createObjectURL(this.mediaSource)}catch(e){}return this._url},set:function(e){this._url=e}}],r=[{key:"clearBuffer",value:function(e){try{for(var t=e.buffered,i=.1,r=0,a=t.length;r<a;r++)i=t.end(r);e.remove(0,i)}catch(e){}}}],i&&n(t.prototype,i),r&&n(t,r),e}()}}]);